<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<meta content="zh-cn" http-equiv="content-language"/>
<meta content="14 计数变化与音效播放" name="description"/>
<link href="/static/favicon.png" rel="icon"/>
<title>14 计数变化与音效播放 </title>
<link href="/static/index.css" rel="stylesheet"/>
<link href="/static/highlight.min.css" rel="stylesheet"/>
<script src="/static/highlight.min.js"></script>
<meta content="Hexo 4.2.0" name="generator"/>
<script data-website-id="83e5d5db-9d06-40e3-b780-cbae722fdf8c" defer="" src="https://umami.lianglianglee.com/script.js"></script>
</head>
<body>
<div class="book-container">
<div class="book-sidebar">
<div class="book-brand">
<a href="/">
<img src="/static/favicon.png"/>
<span>技术文章摘抄</span>
</a>
</div>
<div class="book-menu uncollapsible">
<ul class="uncollapsible">
<li><a class="current-tab" href="/">首页</a></li>
<li><a href="../">上一级</a></li>
</ul>
<ul class="uncollapsible">
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/01%20%e5%89%8d%e8%a8%80-%e6%95%99%e7%a8%8b%e5%86%85%e5%ae%b9%e5%af%bc%e8%af%bb.md.html" id="01 前言-教程内容导读.md.html">01 前言-教程内容导读.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/02%20Flutter%20%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83%e7%9a%84%e6%90%ad%e5%bb%ba.md.html" id="02 Flutter 开发环境的搭建.md.html">02 Flutter 开发环境的搭建.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/03%20%e6%96%b0%e6%89%8b%e6%9d%91%e5%9f%ba%e7%a1%80%20Dart%20%e8%af%ad%e6%b3%95%20%28%e4%b8%8a%29.md.html" id="03 新手村基础 Dart 语法 (上).md.html">03 新手村基础 Dart 语法 (上).md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/04%20%e6%96%b0%e6%89%8b%e6%9d%91%e5%9f%ba%e7%a1%80%20Dart%20%e8%af%ad%e6%b3%95%20%28%e4%b8%8b%29.md.html" id="04 新手村基础 Dart 语法 (下).md.html">04 新手村基础 Dart 语法 (下).md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/05%20Flutter%20%e8%ae%a1%e6%95%b0%e5%99%a8%e9%a1%b9%e7%9b%ae%e8%a7%a3%e8%af%bb.md.html" id="05 Flutter 计数器项目解读.md.html">05 Flutter 计数器项目解读.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/06%20%e7%8c%9c%e6%95%b0%e5%ad%97%e7%95%8c%e9%9d%a2%e4%ba%a4%e4%ba%92%e4%b8%8e%e9%9c%80%e6%b1%82%e5%88%86%e6%9e%90.md.html" id="06 猜数字界面交互与需求分析.md.html">06 猜数字界面交互与需求分析.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/07%20%e4%bd%bf%e7%94%a8%e7%bb%84%e4%bb%b6%e6%9e%84%e5%bb%ba%e9%9d%99%e6%80%81%e7%95%8c%e9%9d%a2.md.html" id="07 使用组件构建静态界面.md.html">07 使用组件构建静态界面.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/08%20%e7%8a%b6%e6%80%81%e6%95%b0%e6%8d%ae%e4%b8%8e%e7%95%8c%e9%9d%a2%e6%9b%b4%e6%96%b0.md.html" id="08 状态数据与界面更新.md.html">08 状态数据与界面更新.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/09%20%e6%a0%a1%e9%aa%8c%e7%bb%93%e6%9e%9c%e4%b8%8e%e6%8f%90%e7%a4%ba%e4%bf%a1%e6%81%af.md.html" id="09 校验结果与提示信息.md.html">09 校验结果与提示信息.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/10%20%e5%8a%a8%e7%94%bb%e4%bd%bf%e7%94%a8%e4%b8%8e%e7%8a%b6%e6%80%81%e5%91%a8%e6%9c%9f.md.html" id="10 动画使用与状态周期.md.html">10 动画使用与状态周期.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/11%20%e7%8c%9c%e6%95%b0%e5%ad%97%e6%95%b4%e7%90%86%e4%b8%8e%e6%80%bb%e7%bb%93.md.html" id="11 猜数字整理与总结.md.html">11 猜数字整理与总结.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/12%20%e7%94%b5%e5%ad%90%e6%9c%a8%e9%b1%bc%e7%95%8c%e9%9d%a2%e4%ba%a4%e4%ba%92%e4%b8%8e%e9%9c%80%e6%b1%82%e5%88%86%e6%9e%90.md.html" id="12 电子木鱼界面交互与需求分析.md.html">12 电子木鱼界面交互与需求分析.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/13%20%e7%94%b5%e5%ad%90%e6%9c%a8%e9%b1%bc%e9%9d%99%e6%80%81%e7%95%8c%e9%9d%a2%e6%9e%84%e5%bb%ba.md.html" id="13 电子木鱼静态界面构建.md.html">13 电子木鱼静态界面构建.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/14%20%e8%ae%a1%e6%95%b0%e5%8f%98%e5%8c%96%e4%b8%8e%e9%9f%b3%e6%95%88%e6%92%ad%e6%94%be.md.html" id="14 计数变化与音效播放.md.html">14 计数变化与音效播放.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/15%20%e5%bc%b9%e5%87%ba%e9%80%89%e9%a1%b9%e4%b8%8e%e5%88%87%e6%8d%a2%e7%8a%b6%e6%80%81.md.html" id="15 弹出选项与切换状态.md.html">15 弹出选项与切换状态.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/16%20%e7%94%a8%e6%bb%91%e5%8a%a8%e5%88%97%e8%a1%a8%e5%b1%95%e7%a4%ba%e8%ae%b0%e5%bd%95.md.html" id="16 用滑动列表展示记录.md.html">16 用滑动列表展示记录.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/17%20%e7%94%b5%e5%ad%90%e6%9c%a8%e9%b1%bc%e6%95%b4%e7%90%86%e4%b8%8e%e6%80%bb%e7%bb%93.md.html" id="17 电子木鱼整理与总结.md.html">17 电子木鱼整理与总结.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/18%20%e7%99%bd%e6%9d%bf%e7%bb%98%e5%88%b6%e7%95%8c%e9%9d%a2%e4%ba%a4%e4%ba%92%e4%b8%8e%e9%9c%80%e6%b1%82%e5%88%86%e6%9e%90.md.html" id="18 白板绘制界面交互与需求分析.md.html">18 白板绘制界面交互与需求分析.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/19%20%e8%ae%a4%e8%af%86%e8%87%aa%e5%ae%9a%e4%b9%89%e7%bb%98%e5%88%b6%e7%bb%84%e4%bb%b6.md.html" id="19 认识自定义绘制组件.md.html">19 认识自定义绘制组件.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/20%20%e9%80%9a%e8%bf%87%e6%89%8b%e5%8a%bf%e5%9c%a8%e7%99%bd%e6%9d%bf%e4%b8%8a%e7%bb%98%e5%88%b6.md.html" id="20 通过手势在白板上绘制.md.html">20 通过手势在白板上绘制.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/21%20%e7%99%bd%e6%9d%bf%e7%94%bb%e7%ac%94%e7%9a%84%e5%8f%82%e6%95%b0%e8%ae%be%e7%bd%ae.md.html" id="21 白板画笔的参数设置.md.html">21 白板画笔的参数设置.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/22%20%e6%92%a4%e9%94%80%e5%8a%9f%e8%83%bd%e4%b8%8e%e7%94%bb%e6%9d%bf%e4%bc%98%e5%8c%96.md.html" id="22 撤销功能与画板优化.md.html">22 撤销功能与画板优化.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/23%20%e5%ba%94%e7%94%a8%e7%95%8c%e9%9d%a2%e6%95%b4%e5%90%88.md.html" id="23 应用界面整合.md.html">23 应用界面整合.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/24%20%e6%95%b0%e6%8d%ae%e7%9a%84%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8.md.html" id="24 数据的持久化存储.md.html">24 数据的持久化存储.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/25%20%e7%bd%91%e7%bb%9c%e6%95%b0%e6%8d%ae%e7%9a%84%e8%ae%bf%e9%97%ae.md.html" id="25 网络数据的访问.md.html">25 网络数据的访问.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Flutter%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b/26%20%e6%95%99%e7%a8%8b%e6%80%bb%e7%bb%93%e4%b8%8e%e5%b1%95%e6%9c%9b.md.html" id="26 教程总结与展望.md.html">26 教程总结与展望.md.html</a>
</li>
<li><a href="/assets/捐赠.md.html">捐赠</a></li>
</ul>
</div>
</div>
<div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseleave="remove_inner()" onmouseover="add_inner()">
<div class="sidebar-toggle-inner"></div>
</div>
<div class="off-canvas-content">
<div class="columns">
<div class="column col-12 col-lg-12">
<div class="book-navbar">
<header class="navbar">
<section class="navbar-section">
<a onclick="open_sidebar()">
<i class="icon icon-menu"></i>
</a>
</section>
</header>
</div>
<div class="book-content" style="max-width: 960px; margin: 0 auto;
    overflow-x: auto;
    overflow-y: hidden;">
<div class="book-post">
<div align="center">因收到Google相关通知，网站将会择期关闭。<a href="https://lumendatabase.org/notices/44265620" target="_blank">相关通知内容</a><hr/></div>
<p align="center" id="tip"></p>
<h1 class="title" data-id="14 计数变化与音效播放" id="title">14 计数变化与音效播放</h1>
<div><h4 id="1-组件点击事件的监听">1. 组件点击事件的监听</h4>
<p>计时器项目中的 <code>FloatingActionButton</code> 按钮，猜数字项目中的 <code>IconButton</code> 点击事件，都是通过构造中的 <code>onPressed</code> 参数传入函数，执行相关逻辑。我们称这种以函数对象作为参数的形式为 <strong>回调函数</strong> 。现在我们的需求是：让图片可以响应点击事件，每次点击时功德数随机增加 <code>1~3</code> 点，并发出敲击的音效。</p>
<table>
<tbody>
<tr>
<td>————————————————————</td>
<td>————————————————————</td>
</tr>
<tr>
<td><img alt="97.gif" src="assets/5fbc04c4f0824397a93d2f524721581a_tplv-k3u1fbpfcp-jj-mark_1890_0_0_0_q75.awebp"/></td>
<td><img alt="98.gif" src="assets/ec6ba67422b94668bfb19d1ac26ab19d_tplv-k3u1fbpfcp-jj-mark_1890_0_0_0_q75.awebp"/></td>
</tr>
</tbody>
</table>
<p>如下所示，在 <code>MuyuAssetsImage</code> 中使用 <code>GestureDetector</code> 嵌套在 <code>Image</code> 之上，这样图片区域内的点击事件，可以通过 <code>onTap</code> 回调监听到。另外，点击时功德累加的逻辑，和图片构建并没有太大关系，这里通过 <code>onTap</code> 入参，将事件向上级传递，交由使用者处理。</p>
<pre><code class="language-scala">class MuyuAssetsImage extends StatelessWidget {
  final String image;
  final VoidCallback onTap;

  const MuyuAssetsImage({super.key, required this.image, required this.onTap});

  @override
  Widget build(BuildContext context) {
    return Center(
      child: GestureDetector( // 使用 GestureDetector 组件监听手势回调
        onTap: onTap,
        child: Image.asset(
          image,
          height: 200,
        ),
      ),
    );
  }
}
</code></pre>
<blockquote>
<p>通过 <code>GestureDetector</code> 组件的 <code>onTap</code> 参数，可以监听到任何组件在其区域内的点击事件。</p>
</blockquote>
<hr/>
<p>在 <code>_MuyuPageState#build</code> 方法中，使用 <code>MuyuAssetsImage</code> 组件时，通过 <code>onTap</code> 参数指定逻辑处理函数，这和 <code>FloatingActionButton的onPressed</code> 点击事件本质上是一样的。这里通过 <code>_onKnock</code> 函数处理点击木鱼的逻辑：</p>
<pre><code class="language-less">----&gt;[_MuyuPageState#build]----
Expanded(
  child: MuyuAssetsImage(
    image: 'assets/images/muyu.png',
    onTap: _onKnock,
  ),
),
</code></pre>
<p>在 <code>_MuyuPageState</code> 中维护界面中需要的状态数据，这里最主要的是功德计数变量，通过 <code>_counter</code> 进行表示。另外，点击时功德数随机增加 <code>1~3</code> ，需要随机数对象。这样，目前的逻辑就比较清晰了：在 <code>_onKnock</code> 函数中，对 <code>_counter</code> 进行累加即可，每次累加值为 <code>1 + _random.nextInt(3)</code> :</p>
<pre><code class="language-ini">int _counter = 0;
final Random _random = Random();

void _onKnock() {
  setState(() {
    int addCount = 1 + _random.nextInt(3);
    _counter += addCount;
  });
}
</code></pre>
<p>最后，将 <code>_counter</code> 作为上半界面 <code>CountPanel</code> 的入参即可。这样点击时，更新 <code>_counter</code> 后，会重新构建，从而展示最新的数据。到这里本质上和计数器没有太大的差异：</p>
<p><img alt="image.png" src="assets/1b022067005044b19fe3985f7c82f76e_tplv-k3u1fbpfcp-jj-mark_1890_0_0_0_q75.awebp"/></p>
<blockquote>
<p>当前代码位置 <a href="https://github.com/toly1994328/flutter_first_station/tree/d6c4f9be050822b0a8ac133686830fee394a34ea/lib/muyu" target="_blank">muyu</a></p>
</blockquote>
<hr/>
<h4 id="2-插件的使用和配置">2. 插件的使用和配置</h4>
<p>Flutter 是一个跨平台的 UI 框架，而音效的播放是平台的功能。在开发过程中，一般使用 <strong>插件</strong> 来完成平台功能。得益于 Flutter 良好的生态环境，在 <a href="https://pub.flutter-io.cn/" target="_blank">pub</a> 中有丰富的优秀插件和包。这里使用 <a href="https://pub.flutter-io.cn/packages/flame_audio" target="_blank">flame_audio</a> 插件来实现短音效播放的功能：</p>
<p><img alt="image.png" src="assets/902a3b4c52b343a58a61d6154a5c9cdb_tplv-k3u1fbpfcp-jj-mark_1890_0_0_0_q75.awebp"/></p>
<hr/>
<p>使用插件，首先要在 <code>pubspec.yaml</code> 的 <code>dependencies</code> 节点下配置依赖，在 <code>pub</code> 中的 <code>installing</code> 页签中，可以看到依赖的版本号：</p>
<p><img alt="image.png" src="assets/dc10805ad66f4647809b8c1678e27586_tplv-k3u1fbpfcp-jj-mark_1890_0_0_0_q75.awebp"/></p>
<hr/>
<p>如下所示，加入依赖后，点击 pub get 获取依赖包：</p>
<p><img alt="image.png" src="assets/585b129a181f4d8e9de506dd6cdd36fe_tplv-k3u1fbpfcp-jj-mark_1890_0_0_0_q75.awebp"/></p>
<hr/>
<p>现在要播放音效，首先需要相关的音频资源，而使用本地资源，需要在 <code>pubspec.yaml</code> 中进行配置：这里准备了三个木鱼点击的音效，放在 <code>audio</code> 文件夹中。</p>
<p><img alt="image.png" src="assets/b5ce09b80f944ce99b6e0f824cafe1d6_tplv-k3u1fbpfcp-jj-mark_1890_0_0_0_q75.awebp"/></p>
<hr/>
<h4 id="3-完成点击播放音效功能">3. 完成点击播放音效功能</h4>
<p>点击事件的逻辑处理在 <code>_MuyuPageState</code> 类中，所以播放音效在该类中处理比较方便。插件的使用也比较简单，首先需要加载资源，通过 <code>FlameAudio.createPool</code> 方法创建 <code>AudioPool</code> 对象。在状态类的 <code>initState</code> 方法中使用 <code>_initAudioPool</code> 创建 <code>pool</code> 对象。</p>
<p>其中第一个参数是资源的名称，<code>flame_audio</code> 默认将本地资源放在 <code>assets/audio</code> 中，指定资源时直接写文件名即可。</p>
<pre><code class="language-scss">----&gt;[_MuyuPageState]----
AudioPool? pool;

@override
void initState() {
  super.initState();
  _initAudioPool();
}

void _initAudioPool() async {
  pool = await FlameAudio.createPool(
    'muyu_1.mp3',
    maxPlayers: 4,
  );
}
</code></pre>
<p>然后，只需要在 <code>_onKnock</code> 方法在调用 <code>pool</code> 的 <code>start</code> 方法进行播放即可：</p>
<pre><code class="language-javascript">void _onKnock() {
  pool?.start();
  // 略同...
}
</code></pre>
<p>到这里，点击木鱼时，就可以听到敲击木鱼的音效，同时功德数也会随机增加 <code>1~3</code> 点。这样就完成了木鱼最基础的功能需求，下面我们将继续优化和拓展，添加一些新的视觉表现和功能。</p>
<blockquote>
<p>当前代码位置 <a href="https://github.com/toly1994328/flutter_first_station/tree/cae6bd19b6fea3186a1b3c10400a95be43c2eafc/lib/muyu" target="_blank">muyu</a></p>
</blockquote>
<hr/>
<h4 id="4-增加功德时的动画展示">4. 增加功德时的动画展示</h4>
<p>如下所示，现在需要在每次点击时展示功德增加的数字，并让数值有动画效果。比如这里是 <code>缩放</code>、<code>移动</code>、<code>透明度</code> 三个动画的叠加，从效果的表现上来说就是文字一边上移，一边缩小、一边透明度降低。</p>
<table>
<tbody>
<tr>
<td>————————————————————</td>
<td>————————————————————</td>
</tr>
<tr>
<td><img alt="99.gif" src="assets/c29ef685cc03488b89cfa30b12f11766_tplv-k3u1fbpfcp-jj-mark_1890_0_0_0_q75.awebp"/></td>
<td><img alt="100.gif" src="assets/fd41acc182954c6ca1a67020d7bf89b0_tplv-k3u1fbpfcp-jj-mark_1890_0_0_0_q75.awebp"/></td>
</tr>
</tbody>
</table>
<hr/>
<p>首先来分析一下界面构建：界面上需要展示的信息增加了 <code>当前增加的功德值</code> ，使用需要增加一个状态数据用于表示。这里使用 <code>_cruValue</code> 变量，该数据维护的时机也很清晰，在点击时更新 <code>_cruValue</code> 的值：</p>
<pre><code class="language-ini">----&gt;[_MuyuPageState]----
int _cruValue = 0;

void _onKnock() {
  pool?.start();
  setState(() {
    _cruValue = 1 + _random.nextInt(3);
    _counter += _cruValue;
  });
}
</code></pre>
<p>这样数据层面就搞定了，下面看一下界面构建逻辑。这里 <code>当前功德</code> 相当于一个浮层，可以通过 <code>Stack</code> 组件和下半部分进行叠放。如下所示，文字从下向上运动到下半部分的顶部：</p>
<p><img alt="image.png" src="assets/7d790339a0914d9f96082e512326799a_tplv-k3u1fbpfcp-jj-mark_1890_0_0_0_q75.awebp"/></p>
<p>由于动画的逻辑比较复杂，这里封装 <code>AnimateText</code> 组件来完成动画文字的功能，其中构造函数传入需要展示的文本信息。下半部分通过 <code>Stack</code> 进行叠放，<code>alignment</code> 入参可以控制孩子们的对齐方式，比如这里 <code>Alignment.topCenter</code> ， 将会以上方中心对齐。表现上来说，就是文字在区域的上方中间：</p>
<p><img alt="image.png" src="assets/e8b2ce6d29bc4e90aa2265d6420a4a18_tplv-k3u1fbpfcp-jj-mark_1890_0_0_0_q75.awebp"/></p>
<hr/>
<p>现在数据和布局已经完成，就差动画效果了。在猜数字中我们简单地了解过动画的使用，通过 AnimatedBuilder 组件，监听动画控制器的变化，在构建组件的过程中让某些属性值不断变化。这里介绍一下几个 <code>XXXTransition</code> 动画组件的使用。</p>
<p>先拿 <code>FadeTransition</code> 组件来说，它的构造中需要传入 <code>Animation&lt;double&gt;</code> 的动画器，表示透明度的动画变化。<code>AnimationController</code> 的数值运动是从 <code>0 ~ 1</code> ，而这里透明度的变化是 <code>1 ~ 0</code>，此时可以使用 <code>Tween</code> 来得到期望的补间动画器。如下 <code>tag1</code> 处，创建了 <code>1~0</code> 变化的动画器 <code>opacity</code> 。在 <code>build</code> 中，使用 <code>FadeTransition</code> 传入 <code>opacity</code> 动画器，当动画控制器运动时，子组件就会产生透明度动画。</p>
<table>
<tbody>
<tr>
<td>————————————————————</td>
<td>————————————————————</td>
</tr>
<tr>
<td><img alt="101.gif" src="assets/5a4e1d55c647446d942a1428904dc1a9_tplv-k3u1fbpfcp-jj-mark_1890_0_0_0_q75.awebp"/></td>
<td><img alt="102.gif" src="assets/6f5b5458079c4d06b60b46172d5834bc_tplv-k3u1fbpfcp-jj-mark_1890_0_0_0_q75.awebp"/></td>
</tr>
</tbody>
</table>
<pre><code class="language-scala">class AnimateText extends StatefulWidget {
  final String text;

  const AnimateText({Key? key, required this.text}) : super(key: key);

  @override
  State&lt;AnimateText&gt; createState() =&gt; _FadTextState();
}

class _FadTextState extends State&lt;AnimateText&gt; with SingleTickerProviderStateMixin {
  late AnimationController controller;
  late Animation&lt;double&gt; opacity;

  @override
  void initState() {
    super.initState();
    controller = AnimationController(vsync: this, duration: const Duration(milliseconds: 500));
    opacity = Tween(begin: 1.0, end: 0.0).animate(controller); // tag1
    controller.forward();
  }

  @override
  void didUpdateWidget(covariant AnimateText oldWidget) {
    super.didUpdateWidget(oldWidget);
    controller.forward(from: 0);
  }

  @override
  void dispose() {
    controller.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return FadeTransition(
      opacity: opacity,
      child: Text(widget.text),
    );
  }
}
</code></pre>
<blockquote>
<p>当前代码位置 <a href="https://github.com/toly1994328/flutter_first_station/tree/ddc9f6e2742a3915b770749d527bd5b9ba87c080/lib/muyu" target="_blank">muyu</a></p>
</blockquote>
<hr/>
<p>同理，使用 <code>ScaleTransition</code> 可以实现缩放动画；使用 <code>SlideTransition</code> 可以实现移动动：</p>
<pre><code class="language-less">@override
Widget build(BuildContext context) {
  return ScaleTransition(
    scale: scale,
    child: SlideTransition(
        position: position,
        child: FadeTransition(
          opacity: opacity,
          child: Text(widget.text),
        )),
  );
}
</code></pre>
<p><code>XXXTransition</code> 组件都需要指定对应类型的 Animation 动画器，而这些动画器可以以 <code>AnimationController</code> 为动力源，通过 <code>Tween</code> 来生成。 缩放变换传入 <code>scale</code> 动画器，从 <code>1 ~ 0.9</code> 变化；移动变化传入 <code>position</code> 动画器，泛型为 <code>Offset</code>，从 <code>Offset(0, 2) ~ Offset.zero</code> 变化，对应的效果就是：在竖直方向上的偏移量，从两倍子组件高度变化到 0 。</p>
<table>
<tbody>
<tr>
<td>————————————————————</td>
<td>————————————————————</td>
</tr>
<tr>
<td><img alt="99.gif" src="assets/c29ef685cc03488b89cfa30b12f11766_tplv-k3u1fbpfcp-jj-mark_1890_0_0_0_q75-1711004037797.awebp"/></td>
<td><img alt="100.gif" src="assets/fd41acc182954c6ca1a67020d7bf89b0_tplv-k3u1fbpfcp-jj-mark_1890_0_0_0_q75-1711004045450.awebp"/></td>
</tr>
</tbody>
</table>
<pre><code class="language-scala">class _FadTextState extends State&lt;AnimateText&gt; with SingleTickerProviderStateMixin {
  late AnimationController controller;
  late Animation&lt;double&gt; opacity;
  late Animation&lt;Offset&gt; position;
  late Animation&lt;double&gt; scale;

  @override
  void initState() {
    super.initState();
    controller = AnimationController(vsync: this, duration: Duration(milliseconds: 500));
    opacity = Tween(begin: 1.0, end: 0.0).animate(controller);
    scale = Tween(begin: 1.0, end: 0.9).animate(controller);
    position = Tween&lt;Offset&gt;(begin: const Offset(0, 2), end: Offset.zero,).animate(controller);
    controller.forward();
  }
</code></pre>
<hr/>
<h4 id="5-本章小结">5.本章小结</h4>
<p>本章我们学习了如何在自己的项目中使用别人提供的类库，这样就可以很轻松地完成复杂的功能。比如这里点击时的音效播放，如果完全靠自己来写代码实现，将会非常困难。但使用别人提供的插件，几行代码就搞定了。所以说，对于一项技术而言，良好的生态是非常重要的。</p>
<p>你可以使用别人的代码实现功能，方便大家；也可以分享自己的代码以供别人使用，让大家一起完善，这就是开源的价值。到这里，就完成了增加功德数动画的展示效果，当前代码位置 <a href="https://github.com/toly1994328/flutter_first_station/tree/94331ae65491459d7474d8230d088b4ade10ff01/lib/muyu" target="_blank">muyu</a> 。下一篇将继续对当前项目进行功能拓展，增加切换音效和木鱼图片的效果。</p>
</div>
</div>
<div>
<div id="prePage" style="float: left">
</div>
<div id="nextPage" style="float: right">
</div>
</div>
</div>
</div>
</div>
<div class="copyright">
<hr>
<p>© 2019 - 2023 <a href="/cdn-cgi/l/email-protection#600c0c0c59545151505720070d01090c4e030f0d" target="_blank">Liangliang Lee</a>.
                    Powered by <a href="https://github.com/gin-gonic/gin" target="_blank">gin</a> and <a href="https://github.com/kaiiiz/hexo-theme-book" target="_blank">hexo-theme-book</a>.</p>
</hr></div>
</div>
<a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9359ee33fd5cc94f',t:'MTc0NTU0MzEwOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NPSEEVD756"></script>
<script src="/static/index.js"></script>
</head></html>