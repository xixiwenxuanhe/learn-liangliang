<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<meta content="zh-cn" http-equiv="content-language"/>
<meta content="37 如何编写 Clang 插件？" name="description"/>
<link href="/static/favicon.png" rel="icon"/>
<title>37 如何编写 Clang 插件？ </title>
<link href="/static/index.css" rel="stylesheet"/>
<link href="/static/highlight.min.css" rel="stylesheet"/>
<script src="/static/highlight.min.js"></script>
<meta content="Hexo 4.2.0" name="generator"/>
<script data-website-id="83e5d5db-9d06-40e3-b780-cbae722fdf8c" defer="" src="https://umami.lianglianglee.com/script.js"></script>
</head>
<body>
<div class="book-container">
<div class="book-sidebar">
<div class="book-brand">
<a href="/">
<img src="/static/favicon.png"/>
<span>技术文章摘抄</span>
</a>
</div>
<div class="book-menu uncollapsible">
<ul class="uncollapsible">
<li><a class="current-tab" href="/">首页</a></li>
<li><a href="../">上一级</a></li>
</ul>
<ul class="uncollapsible">
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/00%20%e5%bc%80%e7%af%87%e8%af%8d%20%e9%94%9a%e5%ae%9a%e4%b8%80%e4%b8%aa%e7%82%b9%ef%bc%8c%e7%84%b6%e5%90%8e%e5%9c%a8%e8%bf%99%e4%b8%aa%e7%82%b9%e4%b8%8a%e6%b7%b1%e8%80%95.md.html" id="00 开篇词 锚定一个点，然后在这个点上深耕.md.html">00 开篇词 锚定一个点，然后在这个点上深耕.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/01%20%e5%bb%ba%e7%ab%8b%e4%bd%a0%e8%87%aa%e5%b7%b1%e7%9a%84iOS%e5%bc%80%e5%8f%91%e7%9f%a5%e8%af%86%e4%bd%93%e7%b3%bb.md.html" id="01 建立你自己的iOS开发知识体系.md.html">01 建立你自己的iOS开发知识体系.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/02%20App%20%e5%90%af%e5%8a%a8%e9%80%9f%e5%ba%a6%e6%80%8e%e4%b9%88%e5%81%9a%e4%bc%98%e5%8c%96%e4%b8%8e%e7%9b%91%e6%8e%a7%ef%bc%9f.md.html" id="02 App 启动速度怎么做优化与监控？.md.html">02 App 启动速度怎么做优化与监控？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/03%20Auto%20Layout%20%e6%98%af%e6%80%8e%e4%b9%88%e8%bf%9b%e8%a1%8c%e8%87%aa%e5%8a%a8%e5%b8%83%e5%b1%80%e7%9a%84%ef%bc%8c%e6%80%a7%e8%83%bd%e5%a6%82%e4%bd%95%ef%bc%9f.md.html" id="03 Auto Layout 是怎么进行自动布局的，性能如何？.md.html">03 Auto Layout 是怎么进行自动布局的，性能如何？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/04%20%e9%a1%b9%e7%9b%ae%e5%a4%a7%e4%ba%86%e4%ba%ba%e5%91%98%e5%a4%9a%e4%ba%86%ef%bc%8c%e6%9e%b6%e6%9e%84%e6%80%8e%e4%b9%88%e8%ae%be%e8%ae%a1%e6%9b%b4%e5%90%88%e7%90%86%ef%bc%9f.md.html" id="04 项目大了人员多了，架构怎么设计更合理？.md.html">04 项目大了人员多了，架构怎么设计更合理？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/05%20%e9%93%be%e6%8e%a5%e5%99%a8%ef%bc%9a%e7%ac%a6%e5%8f%b7%e6%98%af%e6%80%8e%e4%b9%88%e7%bb%91%e5%ae%9a%e5%88%b0%e5%9c%b0%e5%9d%80%e4%b8%8a%e7%9a%84%ef%bc%9f.md.html" id="05 链接器：符号是怎么绑定到地址上的？.md.html">05 链接器：符号是怎么绑定到地址上的？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/06%20App%20%e5%a6%82%e4%bd%95%e9%80%9a%e8%bf%87%e6%b3%a8%e5%85%a5%e5%8a%a8%e6%80%81%e5%ba%93%e7%9a%84%e6%96%b9%e5%bc%8f%e5%ae%9e%e7%8e%b0%e6%9e%81%e9%80%9f%e7%bc%96%e8%af%91%e8%b0%83%e8%af%95%ef%bc%9f.md.html" id="06 App 如何通过注入动态库的方式实现极速编译调试？.md.html">06 App 如何通过注入动态库的方式实现极速编译调试？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/07%20Clang%e3%80%81Infer%20%e5%92%8c%20OCLint%20%ef%bc%8c%e6%88%91%e4%bb%ac%e5%ba%94%e8%af%a5%e4%bd%bf%e7%94%a8%e8%b0%81%e6%9d%a5%e5%81%9a%e9%9d%99%e6%80%81%e5%88%86%e6%9e%90%ef%bc%9f.md.html" id="07 Clang、Infer 和 OCLint ，我们应该使用谁来做静态分析？.md.html">07 Clang、Infer 和 OCLint ，我们应该使用谁来做静态分析？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/08%20%e5%a6%82%e4%bd%95%e5%88%a9%e7%94%a8%20Clang%20%e4%b8%ba%20App%20%e6%8f%90%e8%b4%a8%ef%bc%9f.md.html" id="08 如何利用 Clang 为 App 提质？.md.html">08 如何利用 Clang 为 App 提质？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/09%20%e6%97%a0%e4%be%b5%e5%85%a5%e7%9a%84%e5%9f%8b%e7%82%b9%e6%96%b9%e6%a1%88%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%ef%bc%9f.md.html" id="09 无侵入的埋点方案如何实现？.md.html">09 无侵入的埋点方案如何实现？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/10%20%e5%8c%85%e5%a4%a7%e5%b0%8f%ef%bc%9a%e5%a6%82%e4%bd%95%e4%bb%8e%e8%b5%84%e6%ba%90%e5%92%8c%e4%bb%a3%e7%a0%81%e5%b1%82%e9%9d%a2%e5%ae%9e%e7%8e%b0%e5%85%a8%e6%96%b9%e4%bd%8d%e7%98%a6%e8%ba%ab%ef%bc%9f.md.html" id="10 包大小：如何从资源和代码层面实现全方位瘦身？.md.html">10 包大小：如何从资源和代码层面实现全方位瘦身？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/11%20%e7%83%ad%e7%82%b9%e9%97%ae%e9%a2%98%e7%ad%94%e7%96%91%ef%bc%88%e4%b8%80%ef%bc%89%ef%bc%9a%e5%9f%ba%e7%a1%80%e6%a8%a1%e5%9d%97%e9%97%ae%e9%a2%98%e7%ad%94%e7%96%91.md.html" id="11 热点问题答疑（一）：基础模块问题答疑.md.html">11 热点问题答疑（一）：基础模块问题答疑.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/12%20iOS%20%e5%b4%a9%e6%ba%83%e5%8d%83%e5%a5%87%e7%99%be%e6%80%aa%ef%bc%8c%e5%a6%82%e4%bd%95%e5%85%a8%e9%9d%a2%e7%9b%91%e6%8e%a7%ef%bc%9f.md.html" id="12 iOS 崩溃千奇百怪，如何全面监控？.md.html">12 iOS 崩溃千奇百怪，如何全面监控？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/13%20%e5%a6%82%e4%bd%95%e5%88%a9%e7%94%a8%20RunLoop%20%e5%8e%9f%e7%90%86%e5%8e%bb%e7%9b%91%e6%8e%a7%e5%8d%a1%e9%a1%bf%ef%bc%9f.md.html" id="13 如何利用 RunLoop 原理去监控卡顿？.md.html">13 如何利用 RunLoop 原理去监控卡顿？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/14%20%e4%b8%b4%e8%bf%91%20OOM%ef%bc%8c%e5%a6%82%e4%bd%95%e8%8e%b7%e5%8f%96%e8%af%a6%e7%bb%86%e5%86%85%e5%ad%98%e5%88%86%e9%85%8d%e4%bf%a1%e6%81%af%ef%bc%8c%e5%88%86%e6%9e%90%e5%86%85%e5%ad%98%e9%97%ae%e9%a2%98%ef%bc%9f.md.html" id="14 临近 OOM，如何获取详细内存分配信息，分析内存问题？.md.html">14 临近 OOM，如何获取详细内存分配信息，分析内存问题？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/15%20%e6%97%a5%e5%bf%97%e7%9b%91%e6%8e%a7%ef%bc%9a%e6%80%8e%e6%a0%b7%e8%8e%b7%e5%8f%96%20App%20%e4%b8%ad%e7%9a%84%e5%85%a8%e9%87%8f%e6%97%a5%e5%bf%97%ef%bc%9f.md.html" id="15 日志监控：怎样获取 App 中的全量日志？.md.html">15 日志监控：怎样获取 App 中的全量日志？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/16%20%e6%80%a7%e8%83%bd%e7%9b%91%e6%8e%a7%ef%bc%9a%e8%a1%a1%e9%87%8f%20App%20%e8%b4%a8%e9%87%8f%e7%9a%84%e9%82%a3%e6%8a%8a%e5%b0%ba.md.html" id="16 性能监控：衡量 App 质量的那把尺.md.html">16 性能监控：衡量 App 质量的那把尺.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/17%20%e8%bf%9c%e8%b6%85%e4%bd%a0%e6%83%b3%e8%b1%a1%e7%9a%84%e5%a4%9a%e7%ba%bf%e7%a8%8b%e7%9a%84%e9%82%a3%e4%ba%9b%e5%9d%91.md.html" id="17 远超你想象的多线程的那些坑.md.html">17 远超你想象的多线程的那些坑.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/18%20%e6%80%8e%e4%b9%88%e5%87%8f%e5%b0%91%20App%20%e7%94%b5%e9%87%8f%e6%b6%88%e8%80%97%ef%bc%9f.md.html" id="18 怎么减少 App 电量消耗？.md.html">18 怎么减少 App 电量消耗？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/19%20%e7%83%ad%e7%82%b9%e9%97%ae%e9%a2%98%e7%ad%94%e7%96%91%ef%bc%88%e4%ba%8c%ef%bc%89%ef%bc%9a%e5%9f%ba%e7%a1%80%e6%a8%a1%e5%9d%97%e9%97%ae%e9%a2%98%e7%ad%94%e7%96%91.md.html" id="19 热点问题答疑（二）：基础模块问题答疑.md.html">19 热点问题答疑（二）：基础模块问题答疑.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/20%20iOS%e5%bc%80%e5%8f%91%e7%9a%84%e6%9c%80%e4%bd%b3%e5%ad%a6%e4%b9%a0%e8%b7%af%e5%be%84%e6%98%af%e4%bb%80%e4%b9%88%ef%bc%9f.md.html" id="20 iOS开发的最佳学习路径是什么？.md.html">20 iOS开发的最佳学习路径是什么？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/21%20%e9%99%a4%e4%ba%86%20Cocoa%ef%bc%8ciOS%e8%bf%98%e5%8f%af%e4%bb%a5%e7%94%a8%e5%93%aa%e4%ba%9b%20GUI%20%e6%a1%86%e6%9e%b6%e5%bc%80%e5%8f%91%ef%bc%9f.md.html" id="21 除了 Cocoa，iOS还可以用哪些 GUI 框架开发？.md.html">21 除了 Cocoa，iOS还可以用哪些 GUI 框架开发？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/22%20%e7%bb%86%e8%af%b4%20iOS%20%e5%93%8d%e5%ba%94%e5%bc%8f%e6%a1%86%e6%9e%b6%e5%8f%98%e8%bf%81%ef%bc%8c%e5%93%aa%e4%ba%9b%e6%80%9d%e6%83%b3%e5%8f%af%e4%bb%a5%e4%b8%ba%e6%88%91%e6%89%80%e7%94%a8%ef%bc%9f.md.html" id="22 细说 iOS 响应式框架变迁，哪些思想可以为我所用？.md.html">22 细说 iOS 响应式框架变迁，哪些思想可以为我所用？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/23%20%e5%a6%82%e4%bd%95%e6%9e%84%e9%80%a0%e9%85%b7%e7%82%ab%e7%9a%84%e7%89%a9%e7%90%86%e6%95%88%e6%9e%9c%e5%92%8c%e8%bf%87%e5%9c%ba%e5%8a%a8%e7%94%bb%e6%95%88%e6%9e%9c%ef%bc%9f.md.html" id="23 如何构造酷炫的物理效果和过场动画效果？.md.html">23 如何构造酷炫的物理效果和过场动画效果？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/24%20A_B%20%e6%b5%8b%e8%af%95%ef%bc%9a%e9%aa%8c%e8%af%81%e5%86%b3%e7%ad%96%e6%95%88%e6%9e%9c%e7%9a%84%e5%88%a9%e5%99%a8.md.html" id="24 A_B 测试：验证决策效果的利器.md.html">24 A_B 测试：验证决策效果的利器.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/25%20%e6%80%8e%e6%a0%b7%e6%9e%84%e5%bb%ba%e5%ba%95%e5%b1%82%e7%9a%84%e5%8f%91%e5%b8%83%e5%92%8c%e8%ae%a2%e9%98%85%e4%ba%8b%e4%bb%b6%e6%80%bb%e7%ba%bf%ef%bc%9f.md.html" id="25 怎样构建底层的发布和订阅事件总线？.md.html">25 怎样构建底层的发布和订阅事件总线？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/26%20%e5%a6%82%e4%bd%95%e6%8f%90%e9%ab%98%20JSON%20%e8%a7%a3%e6%9e%90%e7%9a%84%e6%80%a7%e8%83%bd%ef%bc%9f.md.html" id="26 如何提高 JSON 解析的性能？.md.html">26 如何提高 JSON 解析的性能？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/27%20%e5%a6%82%e4%bd%95%e7%94%a8%20Flexbox%20%e6%80%9d%e8%b7%af%e5%bc%80%e5%8f%91%ef%bc%9f%e8%b7%9f%e8%87%aa%e5%8a%a8%e5%b8%83%e5%b1%80%e6%af%94%ef%bc%8cFlexbox%20%e5%a5%bd%e5%9c%a8%e5%93%aa%ef%bc%9f.md.html" id="27 如何用 Flexbox 思路开发？跟自动布局比，Flexbox 好在哪？.md.html">27 如何用 Flexbox 思路开发？跟自动布局比，Flexbox 好在哪？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/28%20%e6%80%8e%e4%b9%88%e5%ba%94%e5%af%b9%e5%90%84%e7%a7%8d%e5%af%8c%e6%96%87%e6%9c%ac%e8%a1%a8%e7%8e%b0%e9%9c%80%e6%b1%82%ef%bc%9f.md.html" id="28 怎么应对各种富文本表现需求？.md.html">28 怎么应对各种富文本表现需求？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/29%20%e5%a6%82%e4%bd%95%e5%9c%a8%20iOS%20%e4%b8%ad%e8%bf%9b%e8%a1%8c%e9%9d%a2%e5%90%91%e6%b5%8b%e8%af%95%e9%a9%b1%e5%8a%a8%e5%bc%80%e5%8f%91%e5%92%8c%e9%9d%a2%e5%90%91%e8%a1%8c%e4%b8%ba%e9%a9%b1%e5%8a%a8%e5%bc%80%e5%8f%91%ef%bc%9f.md.html" id="29 如何在 iOS 中进行面向测试驱动开发和面向行为驱动开发？.md.html">29 如何在 iOS 中进行面向测试驱动开发和面向行为驱动开发？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/30%20%e5%a6%82%e4%bd%95%e5%88%b6%e5%ae%9a%e4%b8%80%e5%a5%97%e9%80%82%e5%90%88%e8%87%aa%e5%b7%b1%e5%9b%a2%e9%98%9f%e7%9a%84%20iOS%20%e7%bc%96%e7%a0%81%e8%a7%84%e8%8c%83%ef%bc%9f.md.html" id="30 如何制定一套适合自己团队的 iOS 编码规范？.md.html">30 如何制定一套适合自己团队的 iOS 编码规范？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/31%20iOS%20%e5%bc%80%e5%8f%91%e5%ad%a6%e4%b9%a0%e8%b5%84%e6%96%99%e5%92%8c%e4%b9%a6%e5%8d%95%e6%8e%a8%e8%8d%90.md.html" id="31 iOS 开发学习资料和书单推荐.md.html">31 iOS 开发学习资料和书单推荐.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/32%20%e7%83%ad%e7%82%b9%e9%97%ae%e9%a2%98%e7%ad%94%e7%96%91%ef%bc%88%e4%b8%89%ef%bc%89.md.html" id="32 热点问题答疑（三）.md.html">32 热点问题答疑（三）.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/33%20iOS%20%e7%b3%bb%e7%bb%9f%e5%86%85%e6%a0%b8%20XNU%ef%bc%9aApp%20%e5%a6%82%e4%bd%95%e5%8a%a0%e8%bd%bd%ef%bc%9f.md.html" id="33 iOS 系统内核 XNU：App 如何加载？.md.html">33 iOS 系统内核 XNU：App 如何加载？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/34%20iOS%20%e9%bb%91%e9%ad%94%e6%b3%95%20Runtime%20Method%20Swizzling%20%e8%83%8c%e5%90%8e%e7%9a%84%e5%8e%9f%e7%90%86.md.html" id="34 iOS 黑魔法 Runtime Method Swizzling 背后的原理.md.html">34 iOS 黑魔法 Runtime Method Swizzling 背后的原理.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/35%20libffi%ef%bc%9a%e5%8a%a8%e6%80%81%e8%b0%83%e7%94%a8%e5%92%8c%e5%ae%9a%e4%b9%89%20C%20%e5%87%bd%e6%95%b0.md.html" id="35 libffi：动态调用和定义 C 函数.md.html">35 libffi：动态调用和定义 C 函数.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/36%20iOS%20%e6%98%af%e6%80%8e%e4%b9%88%e7%ae%a1%e7%90%86%e5%86%85%e5%ad%98%e7%9a%84%ef%bc%9f.md.html" id="36 iOS 是怎么管理内存的？.md.html">36 iOS 是怎么管理内存的？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/37%20%e5%a6%82%e4%bd%95%e7%bc%96%e5%86%99%20Clang%20%e6%8f%92%e4%bb%b6%ef%bc%9f.md.html" id="37 如何编写 Clang 插件？.md.html">37 如何编写 Clang 插件？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/38%20%e7%83%ad%e7%82%b9%e9%97%ae%e9%a2%98%e7%ad%94%e7%96%91%ef%bc%88%e5%9b%9b%ef%bc%89.md.html" id="38 热点问题答疑（四）.md.html">38 热点问题答疑（四）.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/39%20%e6%89%93%e9%80%9a%e5%89%8d%e7%ab%af%e4%b8%8e%e5%8e%9f%e7%94%9f%e7%9a%84%e6%a1%a5%e6%a2%81%ef%bc%9aJavaScriptCore%20%e8%83%bd%e5%b9%b2%e5%93%aa%e4%ba%9b%e4%ba%8b%e6%83%85%ef%bc%9f.md.html" id="39 打通前端与原生的桥梁：JavaScriptCore 能干哪些事情？.md.html">39 打通前端与原生的桥梁：JavaScriptCore 能干哪些事情？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/40%20React%20Native%e3%80%81Flutter%20%e7%ad%89%ef%bc%8c%e8%bf%99%e4%ba%9b%e8%b7%a8%e7%ab%af%e6%96%b9%e6%a1%88%e6%80%8e%e4%b9%88%e9%80%89%ef%bc%9f.md.html" id="40 React Native、Flutter 等，这些跨端方案怎么选？.md.html">40 React Native、Flutter 等，这些跨端方案怎么选？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/41%20%e5%8e%9f%e7%94%9f%e5%b8%83%e5%b1%80%e8%bd%ac%e5%88%b0%e5%89%8d%e7%ab%af%e5%b8%83%e5%b1%80%ef%bc%8c%e5%bc%80%e5%8f%91%e6%80%9d%e8%b7%af%e6%9c%89%e5%93%aa%e4%ba%9b%e8%bd%ac%e5%8f%98%ef%bc%9f.md.html" id="41 原生布局转到前端布局，开发思路有哪些转变？.md.html">41 原生布局转到前端布局，开发思路有哪些转变？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/42%20iOS%e5%8e%9f%e7%94%9f%e3%80%81%e5%a4%a7%e5%89%8d%e7%ab%af%e5%92%8cFlutter%e5%88%86%e5%88%ab%e6%98%af%e6%80%8e%e4%b9%88%e6%b8%b2%e6%9f%93%e7%9a%84%ef%bc%9f.md.html" id="42 iOS原生、大前端和Flutter分别是怎么渲染的？.md.html">42 iOS原生、大前端和Flutter分别是怎么渲染的？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/43%20%e5%89%96%e6%9e%90%e4%bd%bf%20App%20%e5%85%b7%e6%9c%89%e5%8a%a8%e6%80%81%e5%8c%96%e5%92%8c%e7%83%ad%e6%9b%b4%e6%96%b0%e8%83%bd%e5%8a%9b%e7%9a%84%e6%96%b9%e6%a1%88.md.html" id="43 剖析使 App 具有动态化和热更新能力的方案.md.html">43 剖析使 App 具有动态化和热更新能力的方案.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/%e7%94%a8%e6%88%b7%e6%95%85%e4%ba%8b%20%e6%88%91%e6%98%af%e5%a6%82%e4%bd%95%e5%ad%a6%e4%b9%a0%e8%bf%99%e4%b8%aa%e4%b8%93%e6%a0%8f%e7%9a%84%ef%bc%9f.md.html" id="用户故事 我是如何学习这个专栏的？.md.html">用户故事 我是如何学习这个专栏的？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/iOS%e5%bc%80%e5%8f%91%e9%ab%98%e6%89%8b%e8%af%be/%e7%bb%93%e6%9d%9f%e8%af%ad%20%e6%85%a2%e5%87%a0%e6%ad%a5%ef%bc%8c%e6%b7%b1%e5%87%a0%e5%ba%a6.md.html" id="结束语 慢几步，深几度.md.html">结束语 慢几步，深几度.md.html</a>
</li>
<li><a href="/assets/捐赠.md.html">捐赠</a></li>
</ul>
</div>
</div>
<div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseleave="remove_inner()" onmouseover="add_inner()">
<div class="sidebar-toggle-inner"></div>
</div>
<div class="off-canvas-content">
<div class="columns">
<div class="column col-12 col-lg-12">
<div class="book-navbar">
<header class="navbar">
<section class="navbar-section">
<a onclick="open_sidebar()">
<i class="icon icon-menu"></i>
</a>
</section>
</header>
</div>
<div class="book-content" style="max-width: 960px; margin: 0 auto;
    overflow-x: auto;
    overflow-y: hidden;">
<div class="book-post">
<div align="center">因收到Google相关通知，网站将会择期关闭。<a href="https://lumendatabase.org/notices/44265620" target="_blank">相关通知内容</a><hr/></div>
<p align="center" id="tip"></p>
<h1 class="title" data-id="37 如何编写 Clang 插件？" id="title">37 如何编写 Clang 插件？</h1>
<div><p>你好，我是戴铭。今天，我和你分享的主题是，如何编写 Clang 插件。</p>
<p>Clang 使用的是模块化设计，可以将自身功能以库的方式来供上层应用来调用。比如，编码规范检查、IDE 中的语法高亮、语法检查等上层应用，都是使用 Clang 库的接口开发出来的。Clang 库对接上层应用有三个接口库，分别是 LibClang、Clang 插件、LibTooling。关于这三个接口库的介绍，我已经在<a href="https://time.geekbang.org/column/article/87844" target="_blank">第8篇文章</a>中和你详细分享过。</p>
<p>其中，LibClang 为了兼容更多 Clang 版本，相比Clang少了很多功能；Clang 插件和 LibTooling 具备Clang 的全量能力。Clang 插件编写代码的方式，和 LibTooling 几乎一样，不同的是 Clang 插件还能够控制编译过程，可以加 warning，或者直接中断编译提示错误。另外，编写好的 LibTooling 还能够非常方便地转成 Clang 插件。</p>
<p>所以说，Clang 插件在功能上是最全的。今天这篇文章，我们就一起来看看怎样编写和运行 Clang 插件。</p>
<p>Clang 插件代码编写后进行编译的前置条件是编译 Clang。要想编译 Clang ，你就需要先安装 <a href="https://cmake.org/" target="_blank">CMake 工具</a>，来解决跨平台编译规范问题。</p>
<p>我们可以先通过 CMakeList.txt 文件，来定制CMake编译流程，再根据 CMakeList.txt 文件生成目标平台所需的编译文件。这个编译文件，在类UNIX平台就是 Makefile，在 Windows 平台就是 Visual Studio 工程，macOS 里还可以生成 Xcode 工程。所以，你可以使用熟悉的 Xcode 来编译 Clang。</p>
<p>接下来，我就和你说说怎么拉 Clang 的代码，以及编译 Clang 的过程是什么样的。</p>
<h2 id="在-macos-平台上编译-clang">在 macOS 平台上编译 Clang</h2>
<p>接下来的内容，我会以macOS 平台编译 Clang 为例。如果你想在其他平台编译，可以参看<a href="https://llvm.org/docs/CMake.html" target="_blank">官方说明</a>。</p>
<p>首先，从 GitHub 上拉下 Clang 的代码，命令如下：</p>
<pre><code>git clone https://github.com/llvm/llvm-project.git
</code></pre>
<p>然后，执行以下命令，来创建构建所需要的目录：</p>
<pre><code>cd llvm-project
mkdir build (in-tree build is not supported)
cd build
</code></pre>
<p>目录结构如下图：</p>
<p><img alt="" src="assets/db7778e6b36b4fd2ad35a91f433b0787.jpg">-
其中，clang 目录就是类 C 语言编译器的代码目录；llvm 目录的代码包含两部分，一部分是对源码进行平台无关优化的优化器代码，另一部分是生成平台相关汇编代码的生成器代码；lldb 目录里是调试器的代码；lld 里是链接器代码。</img></p>
<p>macOS 属于类UNIX平台，因此既可以生成 Makefile 文件来编译，也可以生成 Xcode 工程来编译。生成 Makefile 文件，你可以使用如下命令：</p>
<pre><code>cmake -DLLVM_ENABLE_PROJECTS=clang -G "Unix Makefiles" ../llvm
make
</code></pre>
<p>生成 Xcode 工程，你可以使用这个命令：</p>
<pre><code>cmake -G Xcode -DLLVM_ENABLE_PROJECTS=clang ../llvm
</code></pre>
<p>执行完后，会在 build 目录下生成 Xcode 工程，路径如下图：</p>
<p><img alt="" src="assets/1315ca45600b46ed851ca3869a85a8ab.jpg"/>-
执行 cmake 命令时，你可能会遇到下面的提示：</p>
<pre><code>-- The C compiler identification is unknown
-- The CXX compiler identification is unknown
CMake Error at CMakeLists.txt:39 (project):
  No CMAKE_C_COMPILER could be found.

CMake Error at CMakeLists.txt:39 (project):
  No CMAKE_CXX_COMPILER could be found.
</code></pre>
<p>这表示 cmake 没有找到代码编译器的命令行工具。这包括两种情况：</p>
<ul>
<li>一是，如果你没有安装 Xcode Commandline Tools的话，可以执行如下命令安装：</li>
</ul>
<pre><code>xcode-select --install
</code></pre>
<ul>
<li>二是，如果你已经安装了Xcode Commandline Tools的话，直接reset 即可，命令如下：</li>
</ul>
<pre><code>sudo xcode-select --reset
</code></pre>
<p>生成 Xcode 工程后，打开生成的 LLVM.xcodeproj文件，选择 Automatically Create Schemes。编译完后生成的库文件，就在 llvm-project⁩/build⁩/⁨Debug/⁩⁨lib/ 目录下。</p>
<p>有了可以编写编译插件的 Xcode 工程，接下来你就可以着手编写 Clang 插件了。</p>
<h2 id="准备编写-clang-插件">准备编写 Clang 插件</h2>
<p>编写之前，先在 llvm-project/clang/tools/ 目录下创建Clang 插件的目录，添加 YourPlugin.cpp 文件和 CMakeLists.txt 文件。其中，CMake 编译需要通过 CMakeLists.txt 文件来指导编译，cpp 是源文件。</p>
<p>接下来，我们可以使用如下代码编写 CMakeLists.txt 文件，来定制编译流程：</p>
<pre><code>add_llvm_library(YourPlugin MODULE YourPlugin.cpp PLUGIN_TOOL clang)
</code></pre>
<p>这段代码是指，要将Clang 插件代码集成到 LLVM 的 Xcode 工程中，并作为一个模块进行编写调试。</p>
<p>想要更多地了解 CMake 的语法和功能，你可以查看<a href="https://cmake.org/documentation/" target="_blank">官方文档</a>。添加了 Clang 插件的目录和文件后，再次用 cmake 命令生成 Xcode 工程，里面就能够集成 YourPlugin.cpp 文件。</p>
<p>到这里，我们已经准备好了Clang 插件开发环境。接下来，我们就能够在Xcode编译器里开发Clang插件了。</p>
<p>编写 Clang 插件代码，入口就是 FrontActions。接下来，我们就一起看看FrontActions 是什么？</p>
<h2 id="frontaction-是什么">FrontAction 是什么？</h2>
<p>FrontActions 是编写 Clang 插件的入口，也是一个接口，是基于ASTFrontendAction 的抽象基类。其实，FrontActions 并没干什么实际的事情，只是为接下来基于 AST 操作的函数提供了一个入口和工作环境。</p>
<p>通过这个接口，你可以编写你要在编译过程中自定义的操作，具体方式是：通过 ASTFrontendAction 在 AST 上自定义操作，重载 CreateASTConsumer 函数返回你自己的 Consumer，以获取 AST 上的 ASTConsumer 单元。</p>
<p>代码示例如下所示：</p>
<pre><code>class FindNamedClassAction : public clang::ASTFrontendAction {
public:
  // 实现 CreateASTConsumer 方法
  virtual std::unique_ptr&lt;clang::ASTConsumer&gt; CreateASTConsumer(
    clang::CompilerInstance &amp;Compiler, llvm::StringRef InFile) {
    // 返回 ASTConsumer 单元
    return std::unique_ptr&lt;clang::ASTConsumer&gt;(
        new FindNamedClassConsumer);
  }
};
</code></pre>
<p>ASTConsumer 可以提供很多入口，是一个可以访问 AST 的抽象基类，可以重载 HandleTopLevelDecl() 和 HandleTranslationUnit() 两个函数，以接收访问 AST 时的回调。其中，HandleTopLevelDecl() 函数是在访问到全局变量、函数定义这样最上层声明时进行回调，HandleTranslationUnit() 函数会在接收每个节点访问时的回调。</p>
<p>下面有一个示例，会重载 HandleTranslationUnit() 函数，使用 ASTContext 为单元调用，通过 RecursiveASTVisitor 来遍历 decl 单元。具体代码如下：</p>
<pre><code>class FindNamedClassConsumer : public clang::ASTConsumer {
public:
  virtual void HandleTranslationUnit(clang::ASTContext &amp;Context) {
    // 通过 RecursiveASTVisitor 来遍历 decl 单元。会访问所有 AST 里的节点。
    Visitor.TraverseDecl(Context.getTranslationUnitDecl());
  }
private:
  // 一个 RecursiveASTVisitor 的实现
  FindNamedClassVisitor Visitor;
};
</code></pre>
<p>上面代码可以看出，接收 AST 节点回调的 TranslationUnitDecl 函数通过重载已经准备就绪，为接下来 RecursiveASTVisitor 访问 AST 节点做好准备工作。</p>
<p>RecursiveASTVisitor 使用深度优先的方式访问 AST 的所有节点。RecursiveASTVisitor 使用的是访问者模式，支持前序遍历和后序遍历来访问 AST 节点。RecursiveASTVisitor 会遍历 AST 的每个节点，遍历节点的同时会回溯，回溯节点类型的基类，再调用节点对应的 Visit 函数。如果重写了节点对应的 Visit 函数，就会调用重写后的 Visit 函数。可以看出真正在干活的是 RecursiveASTVistor，它基本完成了编写 Clang 插件里最多、最重的活儿。</p>
<p>接下来，我就跟你说说怎么用 RecursiveASTVisitor 来查找指定名称的 CXXRecordDecl 类型的 AST 节点。也就是说，你需要通过 RecursiveASTVisitor 实现从 AST 里面提取所需要内容。</p>
<p>CXXRecordDecl 类型，表示 C++ struct/union/class。更多的节点类型，你可以参看<a href="http://clang.llvm.org/docs/LibASTMatchersReference.html" target="_blank">官方文档</a>。</p>
<h2 id="使用-recursiveastvisitor">使用 RecursiveASTVisitor</h2>
<p>RecursiveASTVisitor，可以为大多数的AST 节点提供布尔类型的 VisitNodeType(Nodetype *)。VisitNodeType 返回的布尔值可以控制 RecursiveASTVisitor 的访问，决定对 AST 节点的访问是否要继续下去。</p>
<p>下面，我们来重写一个访问所有 CXXRecordDecl 的 RecursiveASTVisitor。</p>
<pre><code>class FindNamedClassVisitor
  : public RecursiveASTVisitor&lt;FindNamedClassVisitor&gt; {
public:
  bool VisitCXXRecordDecl(CXXRecordDecl *Declaration) {
    // dump 出已经访问的 AST 的声明节点。
    Declaration-&gt;dump();

    // 返回 true 表示继续遍历 AST，false 表示停止遍历 AST。
    return true;
  }
};
</code></pre>
<p>在 RecursiveASTVisitor 的方法里，可以使用 Clang AST 的全部功能获取想要的内容。比如，通过重写 VisitCXXRecordDecl 函数，找到指定名称的所有类声明。示例代码如下：</p>
<pre><code>bool VisitCXXRecordDecl(CXXRecordDecl *Declaration) {
  if (Declaration-&gt;getQualifiedNameAsString() == "n::m::C")
    Declaration-&gt;dump();
  return true;
}
</code></pre>
<p>将代码保存成文件 FindClassDecls.cpp，并创建 CMakeLists.txt 文件来进行链接。CMakeLists.txt 的内容如下：</p>
<pre><code>add_clang_executable(find-class-decls FindClassDecls.cpp)
target_link_libraries(find-class-decls clangTooling)
</code></pre>
<p>使用这个工具能够找到 n :: m :: C 的所有声明，然后输出如下信息：</p>
<pre><code>$ ./bin/find-class-decls "namespace n { namespace m { class C {}; } }"
</code></pre>
<h2 id="编写-pluginastaction-代码">编写 PluginASTAction 代码</h2>
<p>由于 Clang 插件是没有 main 函数的，入口是 PluginASTAction 的 ParseArgs 函数。所以，编写 Clang 插件还要实现ParseArgs来处理入口参数。代码如下所示：</p>
<pre><code>bool ParseArgs(const CompilerInstance &amp;CI,
               const std::vector&lt;std::string&gt;&amp; args) {
  for (unsigned i = 0, e = args.size(); i != e; ++i) {
    if (args[i] == "-some-arg") {
      // 处理命令行参数
    }
  }
  return true;
}
</code></pre>
<h2 id="注册-clang-插件">注册 Clang 插件</h2>
<p>最后，还需要在 Clang 插件源码中编写注册代码。编译器会在编译过程中从动态库加载 Clang 插件。使用 FrontendPluginRegistry::Add&lt;&gt; 在库中注册插件。注册 Clang 插件的代码如下：</p>
<pre><code>static FrontendPluginRegistry::Add&lt;MyPlugin&gt; X("my-plugin-name", "my plugin description");
</code></pre>
<p>在 Clang 插件代码的最下面，定义的 my-plugin-name 字符串是命令行字符串，供以后调用时使用，my plugin description 是对 Clang 插件的描述。</p>
<p>现在，我们已经编写完了 Clang 插件，我来和你汇总下编写过程：</p>
<p>第一步，编写 FrontAction 入口。</p>
<p>第二步，通过 RecursiveASTVisitor 访问所有 AST 节点，获取想要的内容。</p>
<p>第三步，编写 PluginASTAction 代码处理入口参数。</p>
<p>第四步，注册 Clang 插件，提供外部使用。</p>
<p>接下来，我们再看看如何使用编写好的Clang插件吧。</p>
<h2 id="使用-clang-插件">使用 Clang 插件</h2>
<p>LLVM 官方有一个完整可用的 Clang 插件示例，可以帮我们打印出最上层函数的名字，你可以点击<a href="https://github.com/llvm/llvm-project/blob/master/clang/examples/PrintFunctionNames/PrintFunctionNames.cpp" target="_blank">这个链接</a>查看这个示例。</p>
<p>接下来，通过这个插件示例，看看如何使用 Clang 插件。</p>
<p>使用 Clang 插件可以通过 -load 命令行选项加载包含插件注册表的动态库，-load 命令行会加载已经注册了的所有 Clang 插件。使用 -plugin 选项选择要运行的 Clang 插件。Clang 插件的其他参数通过 -plugin-arg- 来传递。</p>
<p>cc1 进程类似一种预处理，这种预处理会发生在编译之前。cc1 和 Clang driver 是两个单独的实体，cc1 负责前端预处理，Clang driver则主要负责管理编译任务调度，每个编译任务都会接受 cc1 前端预处理的参数，然后进行调整。</p>
<p>有两个方法可以让 -load 和 -plugin 等选项到 Clang 的 cc1 进程中：</p>
<ul>
<li>一种是，直接使用 -cc1 选项，缺点是要在命令行上指定完整的系统路径配置；</li>
<li>另一种是，使用 -Xclang 来为 cc1 进程添加这些选项。-Xclang 参数只运行预处理器，直接将后面参数传递给 cc1 进程，而不影响 clang driver 的工作。</li>
</ul>
<p>下面是一个编译 Clang 插件，然后使用 -Xclang 加载使用 Clang 插件的例子：</p>
<pre><code>$ export BD=/path/to/build/directory
$ (cd $BD &amp;&amp; make PrintFunctionNames )
$ clang++ -D_GNU_SOURCE -D_DEBUG -D__STDC_CONSTANT_MACROS \
          -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -D_GNU_SOURCE \
          -I$BD/tools/clang/include -Itools/clang/include -I$BD/include -Iinclude \
          tools/clang/tools/clang-check/ClangCheck.cpp -fsyntax-only \
          -Xclang -load -Xclang $BD/lib/PrintFunctionNames.so -Xclang \
          -plugin -Xclang print-fns
</code></pre>
<p>上面命令中，先设置构建的路径，再通过 make 命令进行编译生成 PrintFunctionNames.so，最后使用 clang 命令配合 -Xclang 参数加载使用 Clang 插件。</p>
<p>你也可以直接使用 -cc1 参数，但是就需要按照下面的方式来指定完整的文件路径：</p>
<pre><code>$ clang -cc1 -load ../../Debug+Asserts/lib/libPrintFunctionNames.dylib -plugin print-fns some-input-file.c
</code></pre>
<h2 id="小结">小结</h2>
<p>今天这篇文章，我主要和你解决的问题是，如何编写 Clang 插件。</p>
<p>Clang 作为编译前端，已经具有很强大的类 C 语言代码解析能力，利用 Clang 的分析能力，你可以在它对代码Clang AST 分析过程中，获取到 AST 各个节点的信息。</p>
<p>Clang AST 节点都是派生自 Type、Decl、Stmt。Clang AST 中最基本的两个节点就是语句 Stmt 和 声明 Decl，表达式 Expr 也是 Stmt。官方有份完整的 Clang AST 节点说明，你可以<a href="http://clang.llvm.org/docs/LibASTMatchersReference.html" target="_blank">点击链接</a>查看使用。</p>
<p>获取到源码全量信息后，就可以更加精准的分析源码，然后统计出不满足编码规范的地方。同时，访问 SourceManager 和 ASTContext，还能够获取到节点所在源代码中的位置信息。这样的话，我们就可以直接通过Clang插件，在问题节点原地修改不规范的代码。</p>
<p>我们可以在 CreateASTConsumer 期间从 CompilerInstance 中获取ASTContext，进而使用其中的 SourceManager 里的 getFullLoc 方法，来获取 AST 节点所在源码的位置。</p>
<p>我们可以把获得的位置信息，分成行和列两个部分，据此就能够确定代码具体位置了。获取源码中位置方法如下面代码所示：</p>
<pre><code>// 使用 ASTContext 的 SourceManager 里的 getFullLoc 方法来获取到 AST 节点所在源码中的位置。
FullSourceLoc FullLocation = Context-&gt;getFullLoc(Declaration-&gt;getBeginLoc());
if (FullLocation.isValid())
  // 按行和列输出
  llvm::outs() &lt;&lt; "Found declaration at "
               &lt;&lt; FullLocation.getSpellingLineNumber() &lt;&lt; ":"
               &lt;&lt; FullLocation.getSpellingColumnNumber() &lt;&lt; "\n";
</code></pre>
<h2 id="课后作业">课后作业</h2>
<p>Clang 插件本身的编写和使用并不复杂，关键是如何更好地应用到工作中，通过 Clang 插件不光能够检查代码规范，还能够进行无用代码分析、自动埋点打桩、线下测试分析、方法名混淆等。</p>
<p>结合现在的工作，你还能够想到 Clang 插件的其他应用场景吗？</p>
<p>感谢你的收听，欢迎你在评论区给我留言分享你的观点，也欢迎把它分享给更多的朋友一起阅读。</p>
</div>
</div>
<div>
<div id="prePage" style="float: left">
</div>
<div id="nextPage" style="float: right">
</div>
</div>
</div>
</div>
</div>
<div class="copyright">
<hr/>
<p>© 2019 - 2023 <a href="/cdn-cgi/l/email-protection#4f232323767b7e7e7f780f28222e2623612c2022" target="_blank">Liangliang Lee</a>.
                    Powered by <a href="https://github.com/gin-gonic/gin" target="_blank">gin</a> and <a href="https://github.com/kaiiiz/hexo-theme-book" target="_blank">hexo-theme-book</a>.</p>
</div>
</div>
<a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9358aa252cc0d6a3',t:'MTc0NTUyOTgzNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NPSEEVD756"></script>
<script src="/static/index.js"></script>
</head></html>