<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<meta content="zh-cn" http-equiv="content-language"/>
<meta content="41 预案，代码的主动风险管理" name="description"/>
<link href="/static/favicon.png" rel="icon"/>
<title>41 预案，代码的主动风险管理 </title>
<link href="/static/index.css" rel="stylesheet"/>
<link href="/static/highlight.min.css" rel="stylesheet"/>
<script src="/static/highlight.min.js"></script>
<meta content="Hexo 4.2.0" name="generator"/>
<script data-website-id="83e5d5db-9d06-40e3-b780-cbae722fdf8c" defer="" src="https://umami.lianglianglee.com/script.js"></script>
</head>
<body>
<div class="book-container">
<div class="book-sidebar">
<div class="book-brand">
<a href="/">
<img src="/static/favicon.png"/>
<span>技术文章摘抄</span>
</a>
</div>
<div class="book-menu uncollapsible">
<ul class="uncollapsible">
<li><a class="current-tab" href="/">首页</a></li>
<li><a href="../">上一级</a></li>
</ul>
<ul class="uncollapsible">
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/00%20%e5%bc%80%e7%af%87%e8%af%8d%20%e4%bd%a0%e5%86%99%e7%9a%84%e6%af%8f%e4%b8%80%e8%a1%8c%e4%bb%a3%e7%a0%81%ef%bc%8c%e9%83%bd%e6%98%af%e4%bd%a0%e7%9a%84%e5%90%8d%e7%89%87.md.html" id="00 开篇词 你写的每一行代码，都是你的名片.md.html">00 开篇词 你写的每一行代码，都是你的名片.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/01%20%e4%bb%8e%e6%9d%a1%e4%bb%b6%e8%bf%90%e7%ae%97%e7%ac%a6%e8%af%b4%e8%b5%b7%ef%bc%8c%e5%8f%8d%e6%80%9d%e4%bb%80%e4%b9%88%e6%98%af%e5%a5%bd%e4%bb%a3%e7%a0%81.md.html" id="01 从条件运算符说起，反思什么是好代码.md.html">01 从条件运算符说起，反思什么是好代码.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/02%20%e6%8a%8a%e9%94%99%e8%af%af%e5%85%b3%e5%9c%a8%e7%ac%bc%e5%ad%90%e9%87%8c%e7%9a%84%e4%ba%94%e9%81%93%e5%85%b3%e5%8d%a1.md.html" id="02 把错误关在笼子里的五道关卡.md.html">02 把错误关在笼子里的五道关卡.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/03%20%e4%bc%98%e7%a7%80%e7%a8%8b%e5%ba%8f%e5%91%98%e7%9a%84%e5%85%ad%e4%b8%aa%e5%85%b3%e9%94%ae%e7%89%b9%e8%b4%a8.md.html" id="03 优秀程序员的六个关键特质.md.html">03 优秀程序员的六个关键特质.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/04%20%e4%bb%a3%e7%a0%81%e8%a7%84%e8%8c%83%e7%9a%84%e4%bb%b7%e5%80%bc%ef%bc%9a%e5%a4%8d%e7%9b%98%e8%8b%b9%e6%9e%9c%e5%85%ac%e5%8f%b8%e7%9a%84GoToFail%e6%bc%8f%e6%b4%9e.md.html" id="04 代码规范的价值：复盘苹果公司的GoToFail漏洞.md.html">04 代码规范的价值：复盘苹果公司的GoToFail漏洞.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/05%20%e7%bb%8f%e9%aa%8c%e6%80%bb%e7%bb%93%ef%bc%9a%e5%a6%82%e4%bd%95%e7%bb%99%e4%bd%a0%e7%9a%84%e4%bb%a3%e7%a0%81%e8%b5%b7%e5%a5%bd%e5%90%8d%e5%ad%97%ef%bc%9f.md.html" id="05 经验总结：如何给你的代码起好名字？.md.html">05 经验总结：如何给你的代码起好名字？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/06%20%e4%bb%a3%e7%a0%81%e6%95%b4%e7%90%86%e7%9a%84%e5%85%b3%e9%94%ae%e9%80%bb%e8%be%91%e5%92%8c%e6%9c%80%e4%bd%b3%e6%a1%88%e4%be%8b.md.html" id="06 代码整理的关键逻辑和最佳案例.md.html">06 代码整理的关键逻辑和最佳案例.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/07%20%e5%86%99%e5%a5%bd%e6%b3%a8%e9%87%8a%ef%bc%8c%e7%9c%9f%e7%9a%84%e6%98%af%e5%b0%8f%e8%8f%9c%e4%b8%80%e7%a2%9f%e5%90%97%ef%bc%9f.md.html" id="07 写好注释，真的是小菜一碟吗？.md.html">07 写好注释，真的是小菜一碟吗？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/08%20%e5%86%99%e5%a5%bd%e5%a3%b0%e6%98%8e%e7%9a%84%e2%80%9c%e5%85%ab%e9%a1%b9%e7%ba%aa%e5%be%8b%e2%80%9d.md.html" id="08 写好声明的“八项纪律”.md.html">08 写好声明的“八项纪律”.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/09%20%e6%80%8e%e4%b9%88%e7%94%a8%e5%a5%bdJava%e6%b3%a8%e8%a7%a3%ef%bc%9f.md.html" id="09 怎么用好Java注解？.md.html">09 怎么用好Java注解？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/10%20%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86%e9%83%bd%e6%9c%89%e5%93%aa%e4%ba%9b%e9%99%b7%e9%98%b1%ef%bc%9f.md.html" id="10 异常处理都有哪些陷阱？.md.html">10 异常处理都有哪些陷阱？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/11%20%e7%bb%84%e7%bb%87%e5%a5%bd%e4%bb%a3%e7%a0%81%e6%ae%b5%ef%bc%8c%e8%ae%a9%e4%ba%ba%e5%af%b9%e5%ae%83%e2%80%9c%e4%b8%80%e8%a7%81%e9%92%9f%e6%83%85%e2%80%9d.md.html" id="11 组织好代码段，让人对它“一见钟情”.md.html">11 组织好代码段，让人对它“一见钟情”.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/12%e4%b8%a8%e7%bb%84%e7%bb%87%e5%a5%bd%e4%bb%a3%e7%a0%81%e6%96%87%e4%bb%b6%ef%bc%8c%e8%a6%81%e6%9c%89%e2%80%9c%e7%94%a8%e6%88%b7%e6%80%9d%e7%bb%b4%e2%80%9d.md.html" id="12丨组织好代码文件，要有“用户思维”.md.html">12丨组织好代码文件，要有“用户思维”.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/13%20%e6%8e%a5%e5%8f%a3%e8%a7%84%e8%8c%83%ef%bc%8c%e6%98%af%e5%8d%8f%e4%bd%9c%e7%9a%84%e5%90%88%e7%ba%a6.md.html" id="13 接口规范，是协作的合约.md.html">13 接口规范，是协作的合约.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/14%20%e6%80%8e%e4%b9%88%e5%86%99%e5%a5%bd%e7%94%a8%e6%88%b7%e6%8c%87%e5%8d%97%ef%bc%9f.md.html" id="14 怎么写好用户指南？.md.html">14 怎么写好用户指南？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/15%20%e7%bc%96%e5%86%99%e8%a7%84%e8%8c%83%e4%bb%a3%e7%a0%81%e7%9a%84%e6%a3%80%e6%9f%a5%e6%b8%85%e5%8d%95.md.html" id="15 编写规范代码的检查清单.md.html">15 编写规范代码的检查清单.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/16%e4%b8%a8%e4%bb%a3%e7%a0%81%e2%80%9c%e8%a7%84%e8%8c%83%e2%80%9d%e7%af%87%e7%94%a8%e6%88%b7%e7%ad%94%e7%96%91.md.html" id="16丨代码“规范”篇用户答疑.md.html">16丨代码“规范”篇用户答疑.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/17%20%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e7%bb%8f%e6%b5%8e%e7%9a%84%e4%bb%a3%e7%a0%81%ef%bc%9f.md.html" id="17 为什么需要经济的代码？.md.html">17 为什么需要经济的代码？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/18%e4%b8%a8%e6%80%9d%e8%80%83%e6%a1%86%e6%9e%b6%ef%bc%9a%e4%bb%80%e4%b9%88%e6%a0%b7%e7%9a%84%e4%bb%a3%e7%a0%81%e6%89%8d%e6%98%af%e9%ab%98%e6%95%88%e7%9a%84%e4%bb%a3%e7%a0%81%ef%bc%9f.md.html" id="18丨思考框架：什么样的代码才是高效的代码？.md.html">18丨思考框架：什么样的代码才是高效的代码？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/19%20%e6%80%8e%e4%b9%88%e9%81%bf%e5%85%8d%e8%bf%87%e5%ba%a6%e8%ae%be%e8%ae%a1%ef%bc%9f.md.html" id="19 怎么避免过度设计？.md.html">19 怎么避免过度设计？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/20%20%e7%ae%80%e5%8d%95%e5%92%8c%e7%9b%b4%e8%a7%82%ef%bc%8c%e6%98%af%e6%b0%b8%e6%81%92%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88.md.html" id="20 简单和直观，是永恒的解决方案.md.html">20 简单和直观，是永恒的解决方案.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/21%20%e6%80%8e%e4%b9%88%e8%ae%be%e8%ae%a1%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e5%8f%88%e7%9b%b4%e8%a7%82%e7%9a%84%e6%8e%a5%e5%8f%a3%ef%bc%9f.md.html" id="21 怎么设计一个简单又直观的接口？.md.html">21 怎么设计一个简单又直观的接口？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/22%e4%b8%a8%e9%ab%98%e6%95%88%e7%8e%87%ef%bc%8c%e4%bb%8e%e8%b6%85%e8%b6%8a%e7%ba%bf%e7%a8%8b%e5%90%8c%e6%ad%a5%e5%bc%80%e5%a7%8b%ef%bc%81.md.html" id="22丨高效率，从超越线程同步开始！.md.html">22丨高效率，从超越线程同步开始！.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/23%20%e6%80%8e%e4%b9%88%e5%87%8f%e5%b0%91%e5%86%85%e5%ad%98%e4%bd%bf%e7%94%a8%ef%bc%8c%e5%87%8f%e8%bd%bb%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86%e8%b4%9f%e6%8b%85%ef%bc%9f.md.html" id="23 怎么减少内存使用，减轻内存管理负担？.md.html">23 怎么减少内存使用，减轻内存管理负担？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/24%20%e9%bb%91%e7%99%bd%e7%81%b0%ef%bc%8c%e7%90%86%e8%a7%a3%e5%bb%b6%e8%bf%9f%e5%88%86%e9%85%8d%e7%9a%84%e4%b8%a4%e9%9d%a2%e6%80%a7.md.html" id="24 黑白灰，理解延迟分配的两面性.md.html">24 黑白灰，理解延迟分配的两面性.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/25%20%e4%bd%bf%e7%94%a8%e6%9c%89%e5%ba%8f%e7%9a%84%e4%bb%a3%e7%a0%81%ef%bc%8c%e8%b0%83%e5%8a%a8%e5%bc%82%e6%ad%a5%e7%9a%84%e4%ba%8b%e4%bb%b6.md.html" id="25 使用有序的代码，调动异步的事件.md.html">25 使用有序的代码，调动异步的事件.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/26%20%e6%9c%89%e5%93%aa%e4%ba%9b%e6%8b%9b%e6%83%b9%e9%ba%bb%e7%83%a6%e7%9a%84%e6%80%a7%e8%83%bd%e9%99%b7%e9%98%b1%ef%bc%9f.md.html" id="26 有哪些招惹麻烦的性能陷阱？.md.html">26 有哪些招惹麻烦的性能陷阱？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/27%20%e6%80%8e%e4%b9%88%e7%bc%96%e5%86%99%e5%8f%af%e6%8c%81%e7%bb%ad%e5%8f%91%e5%b1%95%e7%9a%84%e4%bb%a3%e7%a0%81%ef%bc%9f.md.html" id="27 怎么编写可持续发展的代码？.md.html">27 怎么编写可持续发展的代码？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/28%20%e6%80%8e%e4%b9%88%e5%b0%bd%e9%87%8f%e2%80%9c%e4%b8%8d%e5%86%99%e2%80%9d%e4%bb%a3%e7%a0%81%ef%bc%9f.md.html" id="28 怎么尽量“不写”代码？.md.html">28 怎么尽量“不写”代码？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/29%20%e7%bc%96%e5%86%99%e7%bb%8f%e6%b5%8e%e4%bb%a3%e7%a0%81%e7%9a%84%e6%a3%80%e6%9f%a5%e6%b8%85%e5%8d%95.md.html" id="29 编写经济代码的检查清单.md.html">29 编写经济代码的检查清单.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/30%e4%b8%a8%e2%80%9c%e4%bb%a3%e7%a0%81%e7%bb%8f%e6%b5%8e%e7%af%87%e2%80%9d%e7%ad%94%e7%96%91%e6%b1%87%e6%80%bb.md.html" id="30丨“代码经济篇”答疑汇总.md.html">30丨“代码经济篇”答疑汇总.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/31%20%e4%b8%ba%e4%bb%80%e4%b9%88%e5%ae%89%e5%85%a8%e7%9a%84%e4%bb%a3%e7%a0%81%e8%bf%99%e4%b9%88%e9%87%8d%e8%a6%81%ef%bc%9f.md.html" id="31 为什么安全的代码这么重要？.md.html">31 为什么安全的代码这么重要？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/32%20%e5%a6%82%e4%bd%95%e8%af%84%e4%bc%b0%e4%bb%a3%e7%a0%81%e7%9a%84%e5%ae%89%e5%85%a8%e7%bc%ba%e9%99%b7%ef%bc%9f.md.html" id="32 如何评估代码的安全缺陷？.md.html">32 如何评估代码的安全缺陷？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/33%20%e6%95%b4%e6%95%b0%e7%9a%84%e8%bf%90%e7%ae%97%e6%9c%89%e5%93%aa%e4%ba%9b%e5%ae%89%e5%85%a8%e5%a8%81%e8%83%81%ef%bc%9f.md.html" id="33 整数的运算有哪些安全威胁？.md.html">33 整数的运算有哪些安全威胁？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/34%20%e6%95%b0%e7%bb%84%e5%92%8c%e9%9b%86%e5%90%88%ef%bc%8c%e5%8f%af%e5%8f%98%e9%87%8f%e7%9a%84%e5%ae%89%e5%85%a8%e9%99%b7%e9%98%b1.md.html" id="34 数组和集合，可变量的安全陷阱.md.html">34 数组和集合，可变量的安全陷阱.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/35%20%e6%80%8e%e4%b9%88%e5%a4%84%e7%90%86%e6%95%8f%e6%84%9f%e4%bf%a1%e6%81%af%ef%bc%9f.md.html" id="35 怎么处理敏感信息？.md.html">35 怎么处理敏感信息？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/36%20%e7%bb%a7%e6%89%bf%e6%9c%89%e4%bb%80%e4%b9%88%e5%ae%89%e5%85%a8%e7%bc%ba%e9%99%b7%ef%bc%9f.md.html" id="36 继承有什么安全缺陷？.md.html">36 继承有什么安全缺陷？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/37%20%e8%be%b9%e7%95%8c%ef%bc%8c%e4%bf%a1%e4%bb%bb%e7%9a%84%e5%88%86%e6%b0%b4%e5%b2%ad.md.html" id="37 边界，信任的分水岭.md.html">37 边界，信任的分水岭.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/38%20%e5%af%b9%e8%b1%a1%e5%ba%8f%e5%88%97%e5%8c%96%e7%9a%84%e5%8d%b1%e5%ae%b3%e6%9c%89%e5%a4%9a%e5%a4%a7%ef%bc%9f.md.html" id="38 对象序列化的危害有多大？.md.html">38 对象序列化的危害有多大？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/39%20%e6%80%8e%e4%b9%88%e6%8e%a7%e5%88%b6%e5%a5%bd%e4%bb%a3%e7%a0%81%e7%9a%84%e6%9d%83%e5%8a%9b%ef%bc%9f.md.html" id="39 怎么控制好代码的权力？.md.html">39 怎么控制好代码的权力？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/40%20%e8%a7%84%e8%8c%83%ef%bc%8c%e4%bb%a3%e7%a0%81%e9%95%bf%e6%b2%bb%e4%b9%85%e5%ae%89%e7%9a%84%e5%9f%ba%e7%a1%80.md.html" id="40 规范，代码长治久安的基础.md.html">40 规范，代码长治久安的基础.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/41%20%e9%a2%84%e6%a1%88%ef%bc%8c%e4%bb%a3%e7%a0%81%e7%9a%84%e4%b8%bb%e5%8a%a8%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86.md.html" id="41 预案，代码的主动风险管理.md.html">41 预案，代码的主动风险管理.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/42%20%e7%ba%b5%e6%b7%b1%ef%bc%8c%e4%bb%a3%e7%a0%81%e5%ae%89%e5%85%a8%e7%9a%84%e6%b7%b1%e5%ba%a6%e9%98%b2%e5%be%a1.md.html" id="42 纵深，代码安全的深度防御.md.html">42 纵深，代码安全的深度防御.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/43%20%e7%bc%96%e5%86%99%e5%ae%89%e5%85%a8%e4%bb%a3%e7%a0%81%e7%9a%84%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%e6%b8%85%e5%8d%95.md.html" id="43 编写安全代码的最佳实践清单.md.html">43 编写安全代码的最佳实践清单.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/44%20%e2%80%9c%e4%bb%a3%e7%a0%81%e5%ae%89%e5%85%a8%e7%af%87%e2%80%9d%e7%ad%94%e7%96%91%e6%b1%87%e6%80%bb.md.html" id="44 “代码安全篇”答疑汇总.md.html">44 “代码安全篇”答疑汇总.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/Q&amp;A%e5%8a%a0%e9%a4%90%e4%b8%a8%e5%85%b3%e4%ba%8e%e4%bb%a3%e7%a0%81%e8%b4%a8%e9%87%8f%ef%bc%8c%e4%bd%a0%e5%85%b3%e5%bf%83%e7%9a%84%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf.md.html" id="Q&amp;A加餐丨关于代码质量，你关心的那些事儿.md.html">Q&amp;A加餐丨关于代码质量，你关心的那些事儿.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e4%bb%a3%e7%a0%81%e7%b2%be%e8%bf%9b%e4%b9%8b%e8%b7%af/%e7%bb%93%e6%9d%9f%e8%af%ad%20%e5%a6%82%e4%bd%95%e6%88%90%e4%b8%ba%e4%b8%80%e4%b8%aa%e7%bc%96%e7%a8%8b%e5%a5%bd%e6%89%8b%ef%bc%9f.md.html" id="结束语 如何成为一个编程好手？.md.html">结束语 如何成为一个编程好手？.md.html</a>
</li>
<li><a href="/assets/捐赠.md.html">捐赠</a></li>
</ul>
</div>
</div>
<div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseleave="remove_inner()" onmouseover="add_inner()">
<div class="sidebar-toggle-inner"></div>
</div>
<div class="off-canvas-content">
<div class="columns">
<div class="column col-12 col-lg-12">
<div class="book-navbar">
<header class="navbar">
<section class="navbar-section">
<a onclick="open_sidebar()">
<i class="icon icon-menu"></i>
</a>
</section>
</header>
</div>
<div class="book-content" style="max-width: 960px; margin: 0 auto;
    overflow-x: auto;
    overflow-y: hidden;">
<div class="book-post">
<div align="center">因收到Google相关通知，网站将会择期关闭。<a href="https://lumendatabase.org/notices/44265620" target="_blank">相关通知内容</a><hr/></div>
<p align="center" id="tip"></p>
<h1 class="title" data-id="41 预案，代码的主动风险管理" id="title">41 预案，代码的主动风险管理</h1>
<div><p>上一次，我们聊了保持代码长治久安的基础——代码规范。这一次，我们接着聊第二个方面，代码的风险预案。</p>
<p>有些问题，并没有适用于各种场景的解决办法；有些设计，并不能适用于所有的用户；有些实现，并不能经受过去、现在和未来的检验。在你的日常工作中，有没有这样的情况出现？</p>
<p>做好预案，是我们管理风险的一个很重要的手段。代码的安全管理，也需要预案。</p>
<h2 id="评审案例">评审案例</h2>
<p>让我们一起来看一段节选的Java代码变更。</p>
<pre><code>     public static String[] getDefaultCipherSuites() {
-        int ssl_ctx = SSL_CTX_new();
-        String[] supportedCiphers = SSL_CTX_get_ciphers(ssl_ctx);
-        SSL_CTX_free(ssl_ctx);
-        return supportedCiphers;
+        return new String[] {
+                "SSL_RSA_WITH_RC4_128_MD5",
+                "SSL_RSA_WITH_RC4_128_SHA",
+                "TLS_RSA_WITH_AES_128_CBC_SHA",
                 // snipped
+            };
     }
</code></pre>
<p>对于这段代码，我先做一些说明。其中，“Cipher Suites”指的是我们在前面一篇文章中提到的TLS协议的密码算法族， “SSL_RSA_WITH_RC4_128_MD5”是一种基于RC4加密技术的算法族，“TLS_RSA_WITH_AES_128_CBC_SHA”是一种基于CBC（Cipher Block Chaining，链式加密）模式的算法族。</p>
<p>getDefaultCipherSuites()这个方法返回值的顺序，就是TLS协议使用这些算法的优先级别。比如，变更后的代码，“SSL_RSA_WITH_RC4_128_MD5”算法族具有最高的优先级。相应地， “SSL_RSA_WITH_RC4_128_SHA”具有第二优先级。在安全传输的连接中，优先级靠前的算法会获得优先考虑。 一旦优先的算法被采用，其他的算法就不会被使用了。</p>
<p>这段代码是Andriod系统的一部分。这个修改发生在2010年5月份，这样做是为了使用Android偏爱的RC4加密算法。有了这样的变更，Android就能对算法的选择有更好的安排与控制。</p>
<p>想想上一篇文章中我们说到的BEAST攻击，这个修改是不是很有前瞻性？ BEAST攻击技术是在2011年9月份公布的，有缺陷的算法是基于CBC模式的算法。Android提早了一年把涉及问题的CBC模式设为次优选择。Chrome浏览器可能更早做了类似的修改。所以，当BEAST攻击技术公开后，Google可以很自豪地说：“我们很早就优先使用更安全的RC4算法啦。”</p>
<p>可是，这个变更，还是有一点小问题的。</p>
<h2 id="案例分析">案例分析</h2>
<p>要想看清楚这个问题，我们还需要讲述一段小插曲。</p>
<p>在1999年设计TLS 1.0的时侯，有两种常用的加密算法类型。一个是<strong>分组加密技术</strong>，把原数据分成若干的小块，然后一小块一小块地分组加密。3DES是二十世纪九十年代最流行的分组加密算法。另一个是<strong>流加密技术</strong>，这种加密方式是把原数据一位一位地运算。RC4是二十世纪九十年代最流行的流加密算法。对这两种算法，TLS 1.0都是支持的。其中的分组加密算法，TLS 1.0采用的是链式加密模式。</p>
<p>2011年9月25日，BEAST攻击技术公开发表。通过上一篇的介绍我们都知道，BEAST攻击技术针对的就是链式加密模式，链式加密模式不再安全了。你有没有惊喜地发现，TLS 1.0的设计真是周到，居然还有一个流加密技术可以使用，而且RC4算法被广泛支持。这真是一个可以救命的设计。</p>
<p>如果你回看2011年、2012年的安全分析文章，很多业界的专家都会推荐使用RC4来替代链式加密模式，很多产品也开始变更为优先使用RC4算法。毕竟，BEAST攻击是一个不可忽视的安全问题，而针对BEAST攻击的补救措施并不是一个完美的解决方案。在业界寻找链式加密模式的替代算法的同时，优先使用RC4算法似乎可以让大家喘口气。</p>
<p>这的确是一个救命的设计，但是，这是一个巧合的设计吗？ 如果身处1999年，我还没有足够的经验来判断这样的设计是有意为之，还是仅仅是一个巧合。但是，20年后的今天， 如果我们的产品只支持一种模式的安全算法，我一定如坐针毡。因为我知道，<strong>短则一两天，长则三五年，一个算法的理论模型或者实现方式几乎一定会被破解</strong>。战战兢兢地等待着这个算法被破解，然后再去寻找补救的措施，显然不是一个可以让工程师心情愉悦、身心放松的好选择。</p>
<p>虽然优先使用RC4可以让业界稍作喘息，但是，好景并不长。2013年3月13日，一个研究小组公开了一个关于RC4算法的严重的安全漏洞。不同寻常的是，这一次并没有合适的修改RC4算法的补救措施。该研究小组建议，停止使用RC4，TLS 1.0和1.1版本的用户应该转化到CBC模式的加密算法。这算是一个不小的玩笑，很多应用刚从CBC模式切换到RC4算法不久，就要重新调整，再切换回去。</p>
<p>这就类似于两个病例。CBC模式虽然是一场大病，可是，有成熟的救治方案。虽然那里或者这里或许会留个疤，可是手术一旦实施成功，CBC模式照样活蹦乱跳。 这就好比以前的100米需要跑9.8秒，手术后也可以跑个十一二秒的。虽然离巅峰阶段有点差距，但是问题不算大。</p>
<p>而RC4的问题，就像是医生诊断后，直接重症监护，并时刻准备后事了。冷酷而又无奈！2013年3月13日，RC4算法宣告重病缠身，重症监护。</p>
<p>随后，业界开始重新转换回CBC模式，很多应用开始禁用RC4算法。2013年8月，IETF提出了在TLS协议中禁用RC4算法的议案。2015年2月，该议案获得通过。 RC4算法这个因高效、安全而著名的算法，从2013年3月开始，慢慢淡出人们的视野。</p>
<p>有了上面的小插曲，你知道上面案例代码的问题了吗？ <strong>这段代码写死了TLS协议算法的缺省优先级别</strong>。除非更改代码，否则这个缺省优先级别是无法更改的。一旦优先的算法出了问题，代码修改虽然简单，但是已部署产品的升级，有时候就是一件很复杂的事情。</p>
<p>世事无常，<strong>一个好的设计，需要有双引擎和降落伞</strong>。</p>
<h2 id="双引擎-长远之计">双引擎，长远之计</h2>
<p>现代的客机，一般采用双引擎甚至多引擎设计。如果其中一个引擎失灵，依靠其他的引擎依然可以延程飞行。 有人戏称延程飞行是一个“要么多引擎，要么去游泳”的设计理念。但是，延程飞行时间也是有约束的，比如不得超过90分钟。为什么呢？ 因为延程飞行时，就只有一个发动机在工作了。单引擎运转，总是有更大的安全隐患，这实在是让人不安！</p>
<p>需要注意的是，<strong>双引擎不是备份计划，不是应急计划，不是Plan B，两个引擎日常都要使用</strong>。如果其中一个引擎闲置，那么当真正需要它的时候，我们就不知道它的状态如何，是否可以承担重任。</p>
<p>想一想，为什么CBC模式出事的时候，业界可以切换到RC4算法？ RC4算法出事的时候，业界可以切换回CBC模式？ 其中有很重要的两点值得考虑。</p>
<ol>
<li><p>无论是CBC模式，还是RC4算法，都是实际投入使用的算法。</p></li>
<li><p>无论是CBC模式，还是RC4算法，都是大部分应用同时支持的算法。</p></li>
</ol>
<p>这两条，对于CBC模式和RC4算法之间的成功的切换，都是必不可少的隐性条件。</p>
<p>如果我们理一理TLS协议发展的脉络，就随时可以看到双引擎设计的理念的运用。</p>
<p>1999年，TLS 1.0提供了CBC模式和RC4算法两种加密算法。随后，2003年，发现了CBC模式的安全问题。 2006年发布的TLS 1.1在协议设计层面修复了CBC模式的潜在问题，提供了CBC模式和RC4算法两种加密算法。2008年发布的TLS 1.2添加了AEAD加密算法，加上已被修复的CBC模式和RC4算法，这样就有三种加密算法可供选择。2018年8月发布的TLS 1.3，废弃了CBC模式和RC4算法，只保留了AEAD算法，但是AEAD算法有两个推荐选项，分组密码的GCM模式，和流密码的Chacha20/Ploy1305模式。到2018年8月，TLS协议在这二十年里，逐步废弃了二十年前最流行的算法。但是在整个过程中，一直保持多算法并存的设计。</p>
<p>如果你熟悉JDK的安全规范和实现，可能会注意到，对于每一个类型的算法，我们总是尽可能地提供多种选择。如果一个算法面临问题，我们总是尽快地替换旧算法，并且补充新的算法。这样，尽快地结束单算法的延程飞行状态。所以，提供多种选择，不仅仅是为了提升丰富性，也是为了在面临关键风险的时候，有风险控制的办法。</p>
<p><strong>对于生死攸关的风险点，我们要有双引擎设计的意识</strong>。 然而，也有双引擎解决不了的问题。即便是多引擎飞机，也需要备用降落伞。</p>
<h2 id="降落伞-权宜之计">降落伞，权宜之计</h2>
<p>在上述案例的代码中，算法的缺省优先级别是固定的。 一旦优先的算法出了问题，该怎么办？ 如果等到出了问题、蒙受了损失，再去寻找解决方案，就太晚了。一般情况下，一个好的软件应该备好降落伞，提前设计部署好这些意外风险的应急办法。我们永远不希望使用降落伞，但是如果有意外发生，降落伞的存在就非常必要了。随时需要，随时就可以拿来使用。</p>
<p>以JDK为例，对于TLS协议的密码算法，一旦一个算法出现问题，修改源代码，替换掉出问题的算法是JDK提供的常规解决方案。另外，JDK还提供了多样的应急方案：</p>
<ol>
<li><p>修改JVM系统的安全参数（Security Property），降低出问题算法的优先级；</p></li>
<li><p>修改JVM系统的安全参数（Security Property），废弃出问题算法；</p></li>
<li><p>修改JVM系统的安全参数（Security Property），升级到没有问题TLS版本；</p></li>
<li><p>修改应用的系统属性（System Property）, 使用指定的算法；</p></li>
<li><p>修改应用的系统属性（System Property）, 升级到没有问题的TLS版本。</p></li>
</ol>
<p>JVM系统的安全参数可以控制运营在JVM上的所有应用程序，而应用的系统属性一般只影响使用它的应用程序。</p>
<p>在JDK中，可以通过修改<code>&lt;java-home&gt;/conf/security/java.security</code>文件设置JVM系统的安全参数。比如，“jdk.tls.legacyAlgorithms”是一个设置TLS历史遗留算法的安全参数。一旦一个算法被设置为历史遗留算法，这个算法就不会被优先使用，除非不存在其他可替换的算法。如果我们把RC4算法设置为历史遗留算法，它的优先级就被降到最低，即使它的缺省优先级别是最高的。</p>
<pre><code>jdk.tls.legacyAlgorithms = RC4_128
</code></pre>
<p>一旦在java.security文件中设置了这个参数，所有使用这个JDK配置的应用程序都会受到影响。</p>
<p>一个应用程序运行时，可以指定系统属性，比如：</p>
<pre><code>$ java -Djdk.tls.client.protocols="TLSv1.3" myApp
</code></pre>
<p>那么这个应用程序就使用TLS 1.3版本的客户端。 另外一个运行的程序，也可以使用TLS 1.2。 两个运行程序的设置互不影响。</p>
<pre><code>$ java -Djdk.tls.client.protocols="TLSv1.2" myApp
</code></pre>
<p>通过上面的例子，你可以看到，这些应急方案采用了配置参数的方式，使用非常简单，不需要运营代码的更改。<strong>简单、易用、快速上手，这是我们设计应急降落伞的一个思路。</strong></p>
<p>一旦一个系统采纳了双引擎和降落伞的设计，系统的可靠性和抗风险能力往往会有大幅度提高。 可是，这并不是白白得来的。它同时也意味着软件研发的巨大投入，和软件复杂度的显著提升。</p>
<p>我们总是尽最大的可能使得软件程序简化、简化再简化。可是对于生死攸关的风险点，我们有时需要选择相反的方向，强化、强化再强化。<strong>不是所有的复杂都是必要的，也不是所有的复杂都是不必要的。软件的设计，是一个需要反复权衡、反复妥协的艺术</strong>。</p>
<h2 id="小结">小结</h2>
<p>通过对这个评审案例的讨论，我想和你分享下面两点个人看法。</p>
<ol>
<li><p><strong>尽管我们无法预料未来可能出现的风险，但是软件的设计和实现依然要考虑抗风险的能力</strong>。</p></li>
<li><p><strong>对于生死攸关的风险点，我们既要有长期的双引擎设计的意识，也要有权宜的应急预案</strong>；</p></li>
</ol>
<p>如果深入到软件的架构和设计里，双引擎和降落伞的使用随处可见，你愿意分享你见到过的双引擎和降落伞的案例吗？欢迎在留言区留言。</p>
<h2 id="一起来动手">一起来动手</h2>
<p>这不算是一个练习，而是一个请求。如果你有时间，你能够研究下你使用的语言、架构或者应用，找找其中的风险防范设计吗？ 代码安全和风险控制，是一个需要超大范围合作的技术领域。我们也需要共同创作这一话题，共同学习其中的经验。</p>
<p>比如说，我有个疑问就是，很多业务需要手机验证码，当我的手机不能使用时，我还有没有办法操作我的银行账户？</p>
<p>如果你觉得这篇文章有所帮助，欢迎点击“请朋友读”，把它分享给你的朋友或者同事。</p>
</div>
</div>
<div>
<div id="prePage" style="float: left">
</div>
<div id="nextPage" style="float: right">
</div>
</div>
</div>
</div>
</div>
<div class="copyright">
<hr/>
<p>© 2019 - 2023 <a href="/cdn-cgi/l/email-protection#0a666666333e3b3b3a3d4a6d676b636624696567" target="_blank">Liangliang Lee</a>.
                    Powered by <a href="https://github.com/gin-gonic/gin" target="_blank">gin</a> and <a href="https://github.com/kaiiiz/hexo-theme-book" target="_blank">hexo-theme-book</a>.</p>
</div>
</div>
<a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'935942a299593879',t:'MTc0NTUzNjA4Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NPSEEVD756"></script>
<script src="/static/index.js"></script>
</head></html>