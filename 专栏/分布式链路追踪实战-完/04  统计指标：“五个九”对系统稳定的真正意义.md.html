<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<meta content="zh-cn" http-equiv="content-language"/>
<meta content="04  统计指标：“五个九”对系统稳定的真正意义" name="description"/>
<link href="/static/favicon.png" rel="icon"/>
<title>04  统计指标：“五个九”对系统稳定的真正意义 </title>
<link href="/static/index.css" rel="stylesheet"/>
<link href="/static/highlight.min.css" rel="stylesheet"/>
<script src="/static/highlight.min.js"></script>
<meta content="Hexo 4.2.0" name="generator"/>
<script data-website-id="83e5d5db-9d06-40e3-b780-cbae722fdf8c" defer="" src="https://umami.lianglianglee.com/script.js"></script>
</head>
<body>
<div class="book-container">
<div class="book-sidebar">
<div class="book-brand">
<a href="/">
<img src="/static/favicon.png"/>
<span>技术文章摘抄</span>
</a>
</div>
<div class="book-menu uncollapsible">
<ul class="uncollapsible">
<li><a class="current-tab" href="/">首页</a></li>
<li><a href="../">上一级</a></li>
</ul>
<ul class="uncollapsible">
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/00%20%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98.md.html" id="00 分布式链路追踪实战.md.html">00 分布式链路追踪实战.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/01%20%20%e6%95%b0%e6%8d%ae%e8%a7%82%e6%b5%8b%ef%bc%9a%e6%95%b0%e6%8d%ae%e8%bf%bd%e8%b8%aa%e7%9a%84%e5%9f%ba%e7%9f%b3%e4%bb%8e%e5%93%aa%e9%87%8c%e6%9d%a5%ef%bc%9f.md.html" id="01  数据观测：数据追踪的基石从哪里来？.md.html">01  数据观测：数据追踪的基石从哪里来？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/02%20%20%e7%b3%bb%e7%bb%9f%e6%97%a5%e5%bf%97%ef%bc%9a%e4%bd%95%e4%bb%a5%e6%88%90%e4%b8%ba%e4%bf%9d%e9%9a%9c%e7%a8%b3%e5%ae%9a%e6%80%a7%e7%9a%84%e5%85%b3%e9%94%ae%ef%bc%9f.md.html" id="02  系统日志：何以成为保障稳定性的关键？.md.html">02  系统日志：何以成为保障稳定性的关键？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/03%20%20%e6%97%a5%e5%bf%97%e7%bc%96%e5%86%99%ef%bc%9a%e6%80%8e%e6%a0%b7%e6%89%8d%e8%83%bd%e7%bc%96%e5%86%99%e2%80%9c%e5%8f%af%e8%a7%82%e6%b5%8b%e2%80%9d%e7%9a%84%e7%b3%bb%e7%bb%9f%e6%97%a5%e5%bf%97%ef%bc%9f.md.html" id="03  日志编写：怎样才能编写“可观测”的系统日志？.md.html">03  日志编写：怎样才能编写“可观测”的系统日志？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/04%20%20%e7%bb%9f%e8%ae%a1%e6%8c%87%e6%a0%87%ef%bc%9a%e2%80%9c%e4%ba%94%e4%b8%aa%e4%b9%9d%e2%80%9d%e5%af%b9%e7%b3%bb%e7%bb%9f%e7%a8%b3%e5%ae%9a%e7%9a%84%e7%9c%9f%e6%ad%a3%e6%84%8f%e4%b9%89.md.html" id="04  统计指标：“五个九”对系统稳定的真正意义.md.html">04  统计指标：“五个九”对系统稳定的真正意义.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/05%20%20%e7%9b%91%e6%8e%a7%e6%8c%87%e6%a0%87%ef%bc%9a%e5%a6%82%e4%bd%95%e9%80%9a%e8%bf%87%e5%88%86%e6%9e%90%e6%95%b0%e6%8d%ae%e5%bf%ab%e9%80%9f%e5%ae%9a%e4%bd%8d%e7%b3%bb%e7%bb%9f%e9%9a%90%e6%82%a3%ef%bc%9f%ef%bc%88%e4%b8%8a%ef%bc%89.md.html" id="05  监控指标：如何通过分析数据快速定位系统隐患？（上）.md.html">05  监控指标：如何通过分析数据快速定位系统隐患？（上）.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/06%20%20%e7%9b%91%e6%8e%a7%e6%8c%87%e6%a0%87%ef%bc%9a%e5%a6%82%e4%bd%95%e9%80%9a%e8%bf%87%e5%88%86%e6%9e%90%e6%95%b0%e6%8d%ae%e5%bf%ab%e9%80%9f%e5%ae%9a%e4%bd%8d%e7%b3%bb%e7%bb%9f%e9%9a%90%e6%82%a3%ef%bc%9f%ef%bc%88%e4%b8%8b%ef%bc%89.md.html" id="06  监控指标：如何通过分析数据快速定位系统隐患？（下）.md.html">06  监控指标：如何通过分析数据快速定位系统隐患？（下）.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/07%20%20%e6%8c%87%e6%a0%87%e7%bc%96%e5%86%99%ef%bc%9a%e5%a6%82%e4%bd%95%e7%bc%96%e5%86%99%e5%87%ba%e6%9b%b4%e5%8a%a0%e4%ba%86%e8%a7%a3%e7%b3%bb%e7%bb%9f%e7%9a%84%e6%8c%87%e6%a0%87%ef%bc%9f.md.html" id="07  指标编写：如何编写出更加了解系统的指标？.md.html">07  指标编写：如何编写出更加了解系统的指标？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/08%20%20%e9%93%be%e8%b7%af%e7%9b%91%e6%8e%a7%ef%bc%9a%e4%b8%ba%e4%bb%80%e4%b9%88%e5%af%b9%e4%ba%8e%e7%b3%bb%e7%bb%9f%e8%80%8c%e8%a8%80%e5%bf%85%e4%b8%8d%e5%8f%af%e5%b0%91%ef%bc%9f.md.html" id="08  链路监控：为什么对于系统而言必不可少？.md.html">08  链路监控：为什么对于系统而言必不可少？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/09%20%20%e6%80%a7%e8%83%bd%e5%89%96%e6%9e%90%ef%bc%9a%e5%a6%82%e4%bd%95%e8%a1%a5%e8%b6%b3%e5%88%86%e5%b8%83%e5%bc%8f%e8%bf%bd%e8%b8%aa%e7%9f%ad%e6%9d%bf%ef%bc%9f.md.html" id="09  性能剖析：如何补足分布式追踪短板？.md.html">09  性能剖析：如何补足分布式追踪短板？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/10%20%20%e9%93%be%e8%b7%af%e5%88%86%e6%9e%90%ef%bc%9a%e9%99%a4%e4%ba%86%e8%a7%82%e6%b5%8b%e9%93%be%e8%b7%af%ef%bc%8c%e8%bf%98%e8%83%bd%e5%81%9a%e4%bb%80%e4%b9%88%ef%bc%9f.md.html" id="10  链路分析：除了观测链路，还能做什么？.md.html">10  链路分析：除了观测链路，还能做什么？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/11%20%20%e9%bb%91%e7%99%bd%e7%9b%92%e7%9b%91%e6%8e%a7%ef%bc%9a%e7%b3%bb%e7%bb%9f%e5%8a%9f%e8%83%bd%e4%b8%8e%e7%bb%93%e6%9e%84%e7%a8%b3%e5%ae%9a%e7%9a%84%e6%a0%b9%e5%9f%ba.md.html" id="11  黑白盒监控：系统功能与结构稳定的根基.md.html">11  黑白盒监控：系统功能与结构稳定的根基.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/12%20%20%e7%b3%bb%e7%bb%9f%e5%91%8a%e8%ad%a6%ef%bc%9a%e5%bf%ab%e9%80%9f%e6%84%9f%e7%9f%a5%e4%b8%9a%e5%8a%a1%e9%9a%90%e8%97%8f%e9%97%ae%e9%a2%98.md.html" id="12  系统告警：快速感知业务隐藏问题.md.html">12  系统告警：快速感知业务隐藏问题.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/13%20%20%e5%91%8a%e8%ad%a6%e8%b4%a8%e9%87%8f%ef%bc%9a%e5%a6%82%e4%bd%95%e6%9b%b4%e5%a5%bd%e5%9c%b0%e5%88%9b%e5%bb%ba%e5%91%8a%e8%ad%a6%e8%a7%84%e5%88%99%e5%92%8c%e8%b4%a8%e9%87%8f%ef%bc%9f.md.html" id="13  告警质量：如何更好地创建告警规则和质量？.md.html">13  告警质量：如何更好地创建告警规则和质量？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/14%20%20%e5%91%8a%e8%ad%a6%e5%a4%84%e7%90%86%ef%bc%9a%e6%80%8e%e6%a0%b7%e6%89%8d%e8%83%bd%e6%9b%b4%e5%a5%bd%e5%9c%b0%e8%a7%a3%e5%86%b3%e9%97%ae%e9%a2%98%ef%bc%9f.md.html" id="14  告警处理：怎样才能更好地解决问题？.md.html">14  告警处理：怎样才能更好地解决问题？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/15%20%20%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%ef%bc%9aELK%20%e5%a6%82%e4%bd%95%e6%9b%b4%e9%ab%98%e6%95%88%e5%9c%b0%e6%94%b6%e9%9b%86%e6%97%a5%e5%bf%97%ef%bc%9f.md.html" id="15  日志收集：ELK 如何更高效地收集日志？.md.html">15  日志收集：ELK 如何更高效地收集日志？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/16%20%20%e6%8c%87%e6%a0%87%e4%bd%93%e7%b3%bb%ef%bc%9aPrometheus%20%e5%a6%82%e4%bd%95%e6%9b%b4%e5%ae%8c%e7%be%8e%e5%9c%b0%e6%98%be%e7%a4%ba%e6%8c%87%e6%a0%87%e4%bd%93%e7%b3%bb%ef%bc%9f.md.html" id="16  指标体系：Prometheus 如何更完美地显示指标体系？.md.html">16  指标体系：Prometheus 如何更完美地显示指标体系？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/17%20%20%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%ef%bc%9aZipkin%20%e5%a6%82%e4%bd%95%e8%bf%9b%e8%a1%8c%e5%88%86%e5%b8%83%e5%bc%8f%e8%bf%bd%e8%b8%aa%ef%bc%9f.md.html" id="17  链路追踪：Zipkin 如何进行分布式追踪？.md.html">17  链路追踪：Zipkin 如何进行分布式追踪？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/18%20%20%e8%a7%82%e6%b5%8b%e5%88%86%e6%9e%90%ef%bc%9aSkyWalking%20%e5%a6%82%e4%bd%95%e6%8a%8a%e8%a7%82%e6%b5%8b%e5%92%8c%e5%88%86%e6%9e%90%e7%bb%93%e5%90%88%e8%b5%b7%e6%9d%a5%ef%bc%9f.md.html" id="18  观测分析：SkyWalking 如何把观测和分析结合起来？.md.html">18  观测分析：SkyWalking 如何把观测和分析结合起来？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/19%20%20%e4%ba%91%e7%ab%af%e8%a7%82%e6%b5%8b%ef%bc%9aARMS%20%e5%a6%82%e4%bd%95%e8%bf%9b%e8%a1%8c%e4%ba%91%e8%a7%82%e6%b5%8b%ef%bc%9f.md.html" id="19  云端观测：ARMS 如何进行云观测？.md.html">19  云端观测：ARMS 如何进行云观测？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/20%20%20%e8%bf%90%e7%bb%b4%e9%9b%86%e6%88%90%ef%bc%9a%e5%86%85%e9%83%a8%e7%9a%84%20OSS%20%e7%b3%bb%e7%bb%9f%e5%a6%82%e4%bd%95%e4%b8%8e%e8%a7%82%e6%b5%8b%e7%9b%b8%e7%bb%93%e5%90%88%ef%bc%9f.md.html" id="20  运维集成：内部的 OSS 系统如何与观测相结合？.md.html">20  运维集成：内部的 OSS 系统如何与观测相结合？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/%e5%88%86%e5%b8%83%e5%bc%8f%e9%93%be%e8%b7%af%e8%bf%bd%e8%b8%aa%e5%ae%9e%e6%88%98-%e5%ae%8c/21%20%e7%bb%93%e6%9d%9f%e8%af%ad%20%20%e6%9c%aa%e6%9d%a5%e7%9a%84%e7%9b%91%e6%8e%a7%e6%98%af%e4%bb%80%e4%b9%88%e6%a0%b7%e5%ad%90%ef%bc%9f.md.html" id="21 结束语  未来的监控是什么样子？.md.html">21 结束语  未来的监控是什么样子？.md.html</a>
</li>
<li><a href="/assets/捐赠.md.html">捐赠</a></li>
</ul>
</div>
</div>
<div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseleave="remove_inner()" onmouseover="add_inner()">
<div class="sidebar-toggle-inner"></div>
</div>
<div class="off-canvas-content">
<div class="columns">
<div class="column col-12 col-lg-12">
<div class="book-navbar">
<header class="navbar">
<section class="navbar-section">
<a onclick="open_sidebar()">
<i class="icon icon-menu"></i>
</a>
</section>
</header>
</div>
<div class="book-content" style="max-width: 960px; margin: 0 auto;
    overflow-x: auto;
    overflow-y: hidden;">
<div class="book-post">
<div align="center">因收到Google相关通知，网站将会择期关闭。<a href="https://lumendatabase.org/notices/44265620" target="_blank">相关通知内容</a><hr/></div>
<p align="center" id="tip"></p>
<h1 class="title" data-id="04  统计指标：“五个九”对系统稳定的真正意义" id="title">04  统计指标：“五个九”对系统稳定的真正意义</h1>
<div><p>上一节课，我带你了解了怎样编写出更具有可观测性的日志，更具有可观测性的日志可以帮助我们更快速地定位问题产生的原因。统计指标和日志一样，也是无处不在的。这一节课，我就来带你了解一下统计指标。</p>
<h3 id="指标功能">指标功能</h3>
<p><strong>统计指标</strong>在日常生活中很常见，每月按时到公司的次数、每天代码提交的 commit 数等，都可以算是统计指标。它会记录系统在一段时间内的某个维度的数值，因此，它能最直观地体现出系统是否出现了问题。每一个统计指标都可以被量化为一个数值，因此，它是高度可量化的。根据这一特点，我们可以通过它完成一些工作，比如以下 2 个方面：</p>
<ol>
<li><strong>业务分析</strong>：产品一般可以通过业务型指标了解到产品上线之后的真实效果如何，从而优化下一步的产品决策。业务型指标包括成单率、用户留存等。</li>
<li><strong>系统运行状态</strong>：通过在系统中埋点或是统计已有数据，比如最常见的 CPU 使用率、访问 QPS、响应耗时等，开发人员可以快速了解到系统的运行状态。</li>
</ol>
<p>通过统计指标你能够感性地认识到整个系统的运行情况。出现问题后，各个指标数据会首先出现波动，这些波动会反映出系统是在哪些方面出现了问题，我们可以由此排查出现问题的原因。</p>
<p>前段时间我遇到了一个问题：使用 HttpClient 框架发送 HTTP 请求时总是会卡死，并且堆栈总会卡死在发送请求上。最后我去查询句柄的指标数据时，才发现是因为句柄被占满了，无法执行导致的卡死。</p>
<h3 id="指标类型">指标类型</h3>
<p>介绍了指标的作用后，我们来看一下统计指标都有哪些类型，它们又分别有哪些不同的作用？</p>
<h4 id="计数器-counter">计数器（Counter）</h4>
<p>计数器是一个数值单调递增的指标，一般这个值为 Double 或者 Long 类型。我们比较常见的有 Java 中的 AtomicLong、DoubleAdder，它们的值就是单调递增的。QPS 的值也是通过计数器的形式，然后配合上一些函数计算得出的。</p>
<p><img alt="image" src="assets/CgqCHl8yW_eAKnuGAABkAkOJ2w4716.png"/></p>
<p>图 1：计数器</p>
<h4 id="仪表盘-gauge">仪表盘（Gauge）</h4>
<p>仪表盘和计数器都可以用来查询某个时间点的固定内容的数值，但和计数器不同，仪表盘的值可以随意变化，可以增加也可以减少。比如在 Java 线程池中活跃的线程数，就可以使用 ThreadPoolExecutor 的 getActiveCount 获取；比较常见的 CPU 使用率和内存占用量也可以通过仪表盘获取。</p>
<p><img alt="image" src="assets/Ciqc1F8yXACACNtbAAB9D2b9yO0247.png"/></p>
<p>图 2：仪表盘</p>
<h4 id="直方图-histogram">直方图（Histogram）</h4>
<p>直方图相对复杂一些，它是将多个数值聚合在一起的数据结构，可以表示数据的分布情况。</p>
<p>如下图，它可以将数据分成多个<strong>桶（Bucket）</strong>，每个桶代表一个范围区间（图下横向数），比如第 1 个桶代表 0~10，第二个桶就代表 10~15，以此类推，最后一个桶代表 100 到正无穷。每个桶之间的数字大小可以是不同的，并没有规定要有规律。每个桶和一个数字挂钩（图左纵向数），代表了这个桶的数值。</p>
<p><img alt="2.png" src="assets/Ciqc1F8yXAyAAr1_AANyRfEvYDI870.png"/></p>
<p>图 3：直方图</p>
<p>以最常见的响应耗时举例，我把响应耗时分为多个桶，比如我认为 0~100 毫秒比较快，就可以把这个范围做一个桶，然后是 100~150 毫秒，以此类推。通过这样的形式，可以直观地看到一个时间段内的请求耗时分布图，这有助于我们理解耗时情况分布。</p>
<h4 id="摘要-summary">摘要（Summary）</h4>
<p>摘要与直方图类似，同样表示的是一段时间内的数据结果，但是数据反映的内容不太一样。摘要一般用于标识分位值，分位值就是我们常说的 TP90、TP99 等。</p>
<p>假设有 100 个耗时数值，将所有的数值从低到高排列，取第 90% 的位置，这个位置的值就是 TP90 的值，而这个桶的值假设是 80ms，那么就代表小于等于90%位置的请求都 ≤80ms。</p>
<p>用文字不太好理解，我们来看下面这张图。这是一张比较典型的分位值图，我们可以看到图中有 6 个桶，分别是 50、75、80、90、95、99，而桶的值就是相对应的耗时情况。</p>
<p><img alt="3.png" src="assets/Ciqc1F8yXCuAAFmKAADKIjwhWjo693.png"/></p>
<p>图 4：分位值图</p>
<p>通过分位值图，我们可以看到最小值和最大值以外的一些数据，这些数据在系统调优的时候也有重要参考价值。</p>
<p>在这里面我需要补充一个知识点，叫作<strong>长尾效应</strong>。长尾效应是指少部分类数据在一个数据模型中占了大多数样本，在数据模型中呈现出长长的尾巴的现象。如图所示，最上面的 TP99 相当于这个图表的尾巴，可以看到，1% 用户访问的耗时比其他 5 个桶加起来的都要长。这个时候你如果通过指标查看某个接口的平均响应时间，其实意义不大，因为这 1% 的用户访问已经超出了平均响应时间，所以平均响应时间已经无法反映数据的真实情况了。这时用户会出现严重的量级分化，而量化分级也是我们在进行系统调优时需要着重关注的。</p>
<p>这种情况我们一般很难通过拨测、自己访问来复现。但我们通过观测这一部分内容，通过链路追踪的方式可以定位到问题的根源。这是我在后续课时中会介绍的。</p>
<h3 id="常见指标">常见指标</h3>
<p>在本课时的最后，我会列举一些工作用常见的指标，你可以通过这些指标看到系统运行的情况。</p>
<h4 id="qps">QPS</h4>
<p>Query Per Second，每秒查询的数量。QPS 在系统中很常见，它不再是单单和“查询”这个特殊条件绑定。QPS 现在也与请求量挂钩，我们可以通过这个值查看某个接口的请求量。假设我们在 1 秒内进行了 1 次接口调用，就可以认为在这 1 秒内，QPS 增加了 1。如果系统进行过压测，那么也可以估算出 QPS 的峰值，从而预估系统的容量。</p>
<h4 id="sla">SLA</h4>
<p>Service Level Agreement，服务等级协议。SLA 是服务商和用户之间的协定，规定了服务的性能和可用性。根据这种可量化的协定，双方可以更详细地制定细则，比如没有到达一定的可用性时的赔偿方案。阿里云之前就规定了短信发送的 SLA 方案，并制定了详细的赔偿明细。具体细节可查看： <a href="https://help.aliyun.com/document_detail/63935.html?spm=5176.13910061.sslink.1.64b922b2xSbOT9" target="_blank">https://help.aliyun.com/document_detail/63935.html?spm=5176.13910061.sslink.1.64b922b2xSbOT9</a>。</p>
<p>最常见的可用性指标类似于“四个九”“五个九”，四个九指的是 99.99%，五个九就是 99.999%，以此类推。SLA 并不是一个固定的数值，“四个九”“五个九”只是代表系统可以保持稳定的时间。SLA 会因为成功数与请求数的不同而变化，可能是 95%，也可能是 80%，这需要我们去计算。</p>
<p>如果你要计算某个接口的 SLA 情况，就可以指定一段时间区间，然后依据以下的公式来计算：</p>
<pre><code>总计成功数 / 总计请求数 = 百分比(%) 
</code></pre>
<p>那总计成功数是怎么得来的呢？比如 HTTP 请求，状态码 200 就可以算是成功，此时成功数就可以 +1；dubbo 不出现异常时成功数就可以 +1。当然，这也不是一定的，根据公司内部的 HTTP 响应状态码等内容也可以更细粒度地规定，如果将相应结果中 json 的 code 值 1 定为成功，则满足条件是成功数也可以 +1。</p>
<p>你可能会问，这个 SLA 算出来之后和我们的工作有什么关系呢？比如说，我们需要保证这个服务 1 年的 SLA 是“五个九”。那么 1 年就是时间单位，由此我们可以算出服务不可用的时间：</p>
<pre><code>1 年 = 365 天 = 8760 小时 
三个九 = 8760 * (1 - 99.9%) = 8.76 小时 
四个九 = 8760 * (1 - 99.99%) = 0.876 小时 = 0.876 * 60 = 52.6 分钟 
五个九 = 8760 * (1 - 99.999%) = 0.0876 小时 = 0.0876 * 60 = 5.26 分钟 
</code></pre>
<p>1 年内，该服务不可用的时间为 5.26 分钟。</p>
<p>由此可见，想要保证越多的“九”，就要保证服务稳定，缩短服务错误的时间，因此，它对系统稳定有重要的意义，“九”也成了公认的标准。</p>
<h4 id="apdex">Apdex</h4>
<p>Application Performance Index，应用性能指数。Apdex 会用响应耗时来判断用户对应用性能的满意度，并通过可量化的形式展现出来。通过这个量化的值，我们可以快速感知用户的满意程度。这也是首次和用户的使用体验相结合的一个指标。</p>
<p>Apdex 分为 3 个区间：</p>
<ol>
<li>满意（Satisfactory）：用户对于这样的响应时间是十分满意的，感觉十分流畅。</li>
<li>容忍（Tolerating）：稍微慢了一点儿，但是可以接受。</li>
<li>失望（Frustrating）：实在太慢，快要放弃了。</li>
</ol>
<p>有了这样的指标信息，无论你是否参与了这个服务的开发，无论你是否懂技术，都可以了解这个服务是否令人满意。</p>
<p>那这个衡量用户是否满意的值是怎样计算出来的呢？</p>
<p>它需要管理人员给一个时间单位 T，来表示当小于或等于多少秒的时候用户的感觉非常好的。映射到 3 个区间内，Apdex 规定，符合满意程度的是 1T，符合容忍程度的是 1T~4T，失望则大于 4T。通过这样的形式，我们就能得知当前请求是属于哪个区间的。</p>
<p>比如我们要计算某个时间段内的 Adpex 值，就可以通过这样的公式来计算：</p>
<pre><code>(满意数量 + (容忍数量 / 2)) / 总数 = Apdex 值 
</code></pre>
<p>通过这个公式，我们可以得出服务整体的 Apdex 值，这个值会在 0~1 的范围内。值越接近 1 代表用户的满意度越高。通过这样可自定义阈值的计算方式，如何衡量业务的满意度也有了一个可量化的标准。</p>
<h3 id="结语">结语</h3>
<p>我相信通过对指标的介绍，你应该已经对指标有了更深刻的认识。你觉得除了我上面介绍的这 3 个常见的指标外，还有哪些是你经常关注的指标？ 欢迎在留言区分享你的看法。</p>
<p>下一节，我将带你了解各个数据源上都有哪些数据指标是可以观测的，帮助你更好地通过指标定位系统隐患。</p>
</div>
</div>
<div>
<div id="prePage" style="float: left">
</div>
<div id="nextPage" style="float: right">
</div>
</div>
</div>
</div>
</div>
<div class="copyright">
<hr/>
<p>© 2019 - 2023 <a href="/cdn-cgi/l/email-protection#e08c8c8cd9d4d1d1d0d7a0878d81898cce838f8d" target="_blank">Liangliang Lee</a>.
                    Powered by <a href="https://github.com/gin-gonic/gin" target="_blank">gin</a> and <a href="https://github.com/kaiiiz/hexo-theme-book" target="_blank">hexo-theme-book</a>.</p>
</div>
</div>
<a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'935803661bc97fc3',t:'MTc0NTUyMzAwNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NPSEEVD756"></script>
<script src="/static/index.js"></script>
</head></html>