<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<meta content="zh-cn" http-equiv="content-language"/>
<meta content="04 初步定制：让你的 Vim 更顺手" name="description"/>
<link href="/static/favicon.png" rel="icon"/>
<title>04 初步定制：让你的 Vim 更顺手 </title>
<link href="/static/index.css" rel="stylesheet"/>
<link href="/static/highlight.min.css" rel="stylesheet"/>
<script src="/static/highlight.min.js"></script>
<meta content="Hexo 4.2.0" name="generator"/>
<script data-website-id="83e5d5db-9d06-40e3-b780-cbae722fdf8c" defer="" src="https://umami.lianglianglee.com/script.js"></script>
</head>
<body>
<div class="book-container">
<div class="book-sidebar">
<div class="book-brand">
<a href="/">
<img src="/static/favicon.png"/>
<span>技术文章摘抄</span>
</a>
</div>
<div class="book-menu uncollapsible">
<ul class="uncollapsible">
<li><a class="current-tab" href="/">首页</a></li>
<li><a href="../">上一级</a></li>
</ul>
<ul class="uncollapsible">
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/00%20%e5%af%bc%e8%af%bb%20%e6%b1%a0%e5%bb%ba%e5%bc%ba%ef%bc%9aVim%20%e5%b0%b1%e6%98%af%e5%9b%9b%e4%b8%aa%e5%ad%97%e2%80%9c%e5%94%af%e5%bf%ab%e4%b8%8d%e7%a0%b4%e2%80%9d.md.html" id="00 导读 池建强：Vim 就是四个字“唯快不破”.md.html">00 导读 池建强：Vim 就是四个字“唯快不破”.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/00%20%e5%bc%80%e7%af%87%e8%af%8d%20%e6%88%91%e4%bb%ac%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e5%ad%a6%20Vim%ef%bc%9f.md.html" id="00 开篇词 我们为什么要学 Vim？.md.html">00 开篇词 我们为什么要学 Vim？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/01%20%e5%90%84%e5%b9%b3%e5%8f%b0%e4%b8%8b%e7%9a%84%20Vim%20%e5%ae%89%e8%a3%85%e6%96%b9%e6%b3%95%ef%bc%9a%e4%b8%8a%e8%b7%af%e5%89%8d%e5%87%86%e5%a4%87%e5%a5%bd%e4%bd%a0%e7%9a%84%e5%ae%9d%e9%a9%ac.md.html" id="01 各平台下的 Vim 安装方法：上路前准备好你的宝马.md.html">01 各平台下的 Vim 安装方法：上路前准备好你的宝马.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/02%20%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5%e5%92%8c%e5%9f%ba%e7%a1%80%e5%91%bd%e4%bb%a4%ef%bc%9a%e5%ba%94%e5%af%b9%e7%ae%80%e5%8d%95%e7%9a%84%e7%bc%96%e8%be%91%e4%bb%bb%e5%8a%a1.md.html" id="02 基本概念和基础命令：应对简单的编辑任务.md.html">02 基本概念和基础命令：应对简单的编辑任务.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/03%20%e6%9b%b4%e5%a4%9a%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4%ef%bc%9a%e5%ba%94%e5%af%b9%e7%a8%8d%e5%a4%8d%e6%9d%82%e7%9a%84%e7%bc%96%e8%be%91%e4%bb%bb%e5%8a%a1.md.html" id="03 更多常用命令：应对稍复杂的编辑任务.md.html">03 更多常用命令：应对稍复杂的编辑任务.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/04%20%e5%88%9d%e6%ad%a5%e5%ae%9a%e5%88%b6%ef%bc%9a%e8%ae%a9%e4%bd%a0%e7%9a%84%20Vim%20%e6%9b%b4%e9%a1%ba%e6%89%8b.md.html" id="04 初步定制：让你的 Vim 更顺手.md.html">04 初步定制：让你的 Vim 更顺手.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/05%20%e5%a4%9a%e6%96%87%e4%bb%b6%e6%89%93%e5%bc%80%e4%b8%8e%e7%bc%93%e5%86%b2%e5%8c%ba%ef%bc%9a%e5%a4%8d%e5%88%b6%e7%b2%98%e8%b4%b4%e7%9a%84%e6%ad%a3%e7%a1%ae%e5%a7%bf%e5%8a%bf.md.html" id="05 多文件打开与缓冲区：复制粘贴的正确姿势.md.html">05 多文件打开与缓冲区：复制粘贴的正确姿势.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/06%20%e7%aa%97%e5%8f%a3%e5%92%8c%e6%a0%87%e7%ad%be%e9%a1%b5%ef%bc%9a%e4%bf%ae%e6%94%b9%e3%80%81%e5%af%b9%e6%af%94%e5%a4%9a%e4%b8%aa%e6%96%87%e4%bb%b6%e7%9a%84%e6%ad%a3%e7%a1%ae%e5%a7%bf%e5%8a%bf.md.html" id="06 窗口和标签页：修改、对比多个文件的正确姿势.md.html">06 窗口和标签页：修改、对比多个文件的正确姿势.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/07%20%e6%ad%a3%e5%88%99%e8%a1%a8%e8%be%be%e5%bc%8f%ef%bc%9a%e5%ae%9e%e7%8e%b0%e6%96%87%e4%bb%b6%e5%86%85%e5%ae%b9%e7%9a%84%e6%90%9c%e7%b4%a2%e5%92%8c%e6%9b%bf%e6%8d%a2.md.html" id="07 正则表达式：实现文件内容的搜索和替换.md.html">07 正则表达式：实现文件内容的搜索和替换.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/08%20%e5%9f%ba%e6%9c%ac%e7%bc%96%e7%a8%8b%e6%94%af%e6%8c%81%ef%bc%9a%e8%a7%84%e9%81%bf%e3%80%81%e8%a7%a3%e5%86%b3%e7%bc%96%e7%a8%8b%e6%97%b6%e7%9a%84%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98.md.html" id="08 基本编程支持：规避、解决编程时的常见问题.md.html">08 基本编程支持：规避、解决编程时的常见问题.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/09%20%e4%b8%83%e5%a4%a7%e5%b8%b8%e7%94%a8%e6%8a%80%e5%b7%a7%ef%bc%9a%e8%ae%a9%e7%bc%96%e8%be%91%e6%95%88%e7%8e%87%e5%86%8d%e4%b8%8a%e4%b8%80%e4%b8%aa%e5%8f%b0%e9%98%b6.md.html" id="09 七大常用技巧：让编辑效率再上一个台阶.md.html">09 七大常用技巧：让编辑效率再上一个台阶.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/10%20%e4%bb%a3%e7%a0%81%e9%87%8d%e6%9e%84%e5%ae%9e%e9%aa%8c%ef%bc%9a%e5%9c%a8%e5%ae%9e%e6%88%98%e4%b8%ad%e6%8f%90%e9%ab%98%e7%bc%96%e8%be%91%e7%86%9f%e7%bb%83%e5%ba%a6.md.html" id="10 代码重构实验：在实战中提高编辑熟练度.md.html">10 代码重构实验：在实战中提高编辑熟练度.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/11%20%e6%96%87%e6%9c%ac%e7%9a%84%e7%bb%86%e8%8a%82%ef%bc%9a%e5%85%b3%e4%ba%8e%e5%ad%97%e7%ac%a6%e3%80%81%e7%bc%96%e7%a0%81%e3%80%81%e8%a1%8c%e4%bd%a0%e6%89%80%e9%9c%80%e8%a6%81%e7%9f%a5%e9%81%93%e7%9a%84%e4%b8%80%e5%88%87.md.html" id="11 文本的细节：关于字符、编码、行你所需要知道的一切.md.html">11 文本的细节：关于字符、编码、行你所需要知道的一切.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/12%20%e8%af%ad%e6%b3%95%e5%8a%a0%e4%ba%ae%e5%92%8c%e9%85%8d%e8%89%b2%e6%96%b9%e6%a1%88%ef%bc%9a%e9%a2%9c%e5%8d%b3%e6%ad%a3%e4%b9%89.md.html" id="12 语法加亮和配色方案：颜即正义.md.html">12 语法加亮和配色方案：颜即正义.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/13%20YouCompleteMe%ef%bc%9aVim%20%e9%87%8c%e7%9a%84%e8%87%aa%e5%8a%a8%e5%ae%8c%e6%88%90.md.html" id="13 YouCompleteMe：Vim 里的自动完成.md.html">13 YouCompleteMe：Vim 里的自动完成.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/14%20Vim%20%e8%84%9a%e6%9c%ac%e7%ae%80%e4%bb%8b%ef%bc%9a%e5%bc%80%e5%a7%8b%e4%bd%a0%e7%9a%84%e6%b7%b1%e5%ba%a6%e5%ae%9a%e5%88%b6.md.html" id="14 Vim 脚本简介：开始你的深度定制.md.html">14 Vim 脚本简介：开始你的深度定制.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/15%20%e6%8f%92%e4%bb%b6%e8%8d%9f%e8%90%83%ef%bc%9a%e4%b8%8d%e5%8f%af%e6%88%96%e7%bc%ba%e7%9a%84%e6%8f%92%e4%bb%b6.md.html" id="15 插件荟萃：不可或缺的插件.md.html">15 插件荟萃：不可或缺的插件.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/16%20%e7%bb%88%e7%ab%af%e5%92%8c%20GDB%20%e6%94%af%e6%8c%81%ef%bc%9a%e4%b8%8d%e7%a6%bb%e5%bc%80%20Vim%20%e5%ae%8c%e6%88%90%e5%bc%80%e5%8f%91%e4%bb%bb%e5%8a%a1.md.html" id="16 终端和 GDB 支持：不离开 Vim 完成开发任务.md.html">16 终端和 GDB 支持：不离开 Vim 完成开发任务.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/%e6%8b%93%e5%b1%951%20%e7%ba%af%e6%96%87%e6%9c%ac%e7%bc%96%e8%be%91%ef%bc%9a%e4%bd%bf%e7%94%a8%20Vim%20%e4%b9%a6%e5%86%99%e4%b8%ad%e8%8b%b1%e6%96%87%e6%96%87%e6%a1%a3.md.html" id="拓展1 纯文本编辑：使用 Vim 书写中英文文档.md.html">拓展1 纯文本编辑：使用 Vim 书写中英文文档.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/%e6%8b%93%e5%b1%952%20C%20%e7%a8%8b%e5%ba%8f%e5%91%98%e7%9a%84%20Vim%20%e5%b7%a5%e4%bd%9c%e7%8e%af%e5%a2%83%ef%bc%9aC%20%e4%bb%a3%e7%a0%81%e7%9a%84%e6%90%9c%e7%b4%a2%e3%80%81%e6%8f%90%e7%a4%ba%e5%92%8c%e8%87%aa%e5%8a%a8%e5%ae%8c%e6%88%90.md.html" id="拓展2 C 程序员的 Vim 工作环境：C 代码的搜索、提示和自动完成.md.html">拓展2 C 程序员的 Vim 工作环境：C 代码的搜索、提示和自动完成.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/%e6%8b%93%e5%b1%953%20Python%20%e7%a8%8b%e5%ba%8f%e5%91%98%e7%9a%84%20Vim%20%e5%b7%a5%e4%bd%9c%e7%8e%af%e5%a2%83%ef%bc%9a%e5%ae%8c%e6%95%b4%e7%9a%84%20Python%20%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83.md.html" id="拓展3 Python 程序员的 Vim 工作环境：完整的 Python 开发环境.md.html">拓展3 Python 程序员的 Vim 工作环境：完整的 Python 开发环境.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/%e6%8b%93%e5%b1%954%20%e6%8f%92%e4%bb%b6%e6%a0%b7%e4%be%8b%e5%88%86%e6%9e%90%ef%bc%9a%e8%87%aa%e5%b7%b1%e5%8a%a8%e6%89%8b%e6%94%b9%e8%bf%9b%e6%8f%92%e4%bb%b6.md.html" id="拓展4 插件样例分析：自己动手改进插件.md.html">拓展4 插件样例分析：自己动手改进插件.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/%e6%8b%93%e5%b1%955%20%e5%85%b6%e4%bb%96%e6%8f%92%e4%bb%b6%e5%92%8c%e6%8a%80%e5%b7%a7%ef%bc%9a%e5%90%b4%e5%92%8f%e7%82%9c%e7%9a%84%e7%ae%b1%e5%ba%95%e7%a7%81%e8%97%8f.md.html" id="拓展5 其他插件和技巧：吴咏炜的箱底私藏.md.html">拓展5 其他插件和技巧：吴咏炜的箱底私藏.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Vim%20%e5%ae%9e%e7%94%a8%e6%8a%80%e5%b7%a7%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a/%e7%bb%93%e6%9d%9f%e8%af%ad%20Vim%20%e6%a3%ae%e6%9e%97%e6%8e%a2%e7%a7%98%ef%bc%8c%e4%b8%80%e5%88%87%e6%89%8d%e5%88%9a%e5%88%9a%e5%bc%80%e5%a7%8b.md.html" id="结束语 Vim 森林探秘，一切才刚刚开始.md.html">结束语 Vim 森林探秘，一切才刚刚开始.md.html</a>
</li>
<li><a href="/assets/捐赠.md.html">捐赠</a></li>
</ul>
</div>
</div>
<div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseleave="remove_inner()" onmouseover="add_inner()">
<div class="sidebar-toggle-inner"></div>
</div>
<div class="off-canvas-content">
<div class="columns">
<div class="column col-12 col-lg-12">
<div class="book-navbar">
<header class="navbar">
<section class="navbar-section">
<a onclick="open_sidebar()">
<i class="icon icon-menu"></i>
</a>
</section>
</header>
</div>
<div class="book-content" style="max-width: 960px; margin: 0 auto;
    overflow-x: auto;
    overflow-y: hidden;">
<div class="book-post">
<div align="center">因收到Google相关通知，网站将会择期关闭。<a href="https://lumendatabase.org/notices/44265620" target="_blank">相关通知内容</a><hr/></div>
<p align="center" id="tip"></p>
<h1 class="title" data-id="04 初步定制：让你的 Vim 更顺手" id="title">04 初步定制：让你的 Vim 更顺手</h1>
<div><p>你好，我是吴咏炜。</p>
<p>在前几讲，我已经介绍了不少 Vim 的常用命令，我想你已经略有心得了吧。今天我们转换一下视角，来讲一下 Vim 这个软件本身。</p>
<p>作为一个 Vim 的使用者，光熟悉命令是不够的，你还需要定制 Vim。因为每个人的习惯和需求都是不一样的，一个高度定制化的 Vim 环境能大大提高你的工作效率。</p>
<p>今天，我会先带你了解一下 Vim 的运行支持文件目录结构，然后我们再一起探索 Vim 8 带来的新功能，及如何对 Vim 进行初步配置来使得 Vim 更加好用。</p>
<h2 id="vim-的目录结构">Vim 的目录结构</h2>
<p>Vim 的工作环境是由运行支持文件来设定的。如果你想要定制 Vim，就要熟知 Vim 有哪些不同类型的运行支持文件，分别存放在哪里，怎样能快捷地找到它们。Vim 比较有意思的一点的是，虽然运行支持文件是在 Vim 的安装目录下，但用户自己是可以“克隆”这个目录结构的。也就是说，你自己目录下的用户配置，到你深度定制的时候，也有相似的目录结构。所以，我就先从这些文件的目录结构开始讲起。</p>
<h3 id="安装目录下的运行支持文件">安装目录下的运行支持文件</h3>
<p>Vim 的运行支持文件在不同的平台上有着相似的目录结构。以 Vim 8.2 为例，它们的标准安装位置分别在：</p>
<ul>
<li>大部分 Unix 下面：/usr/share/vim/vim82</li>
<li>macOS Homebrew 下：/usr/local/opt/macvim/MacVim.app/Contents/Resources/vim/runtime</li>
<li>Windows 下：C:\Program Files (x86)\Vim\vim82</li>
</ul>
<p>在这个目录下面，你可以看到很多子目录，如 autoload、colors、doc、pack、plugin、syntax 等等。这些子目录下面就是分类放置的 Vim 支持文件。最常用的子目录应该是下面这几个：</p>
<ul>
<li>syntax：Vim 的语法加亮文件</li>
<li>doc：Vim 的帮助文件</li>
<li>colors：Vim 的配色方案</li>
<li>plugin：Vim 的“插件”，即用来增强 Vim 功能的工具</li>
</ul>
<p>以 syntax 目录为例，当前我在下面看到有 617 个文件，也就是说，Vim 对 617 种不同的文件类型提供了语法加亮支持！这里面的文件去掉“.vim”后缀后，就是文件类型的名字，你可以用类似 <code>:setfiletype java</code> 这样的命令来设置文件的类型，从而进行语法加亮。目录下我们可以看到大家都很熟悉的语言，也有很多我从来都没听说过的东西。</p>
<p>只要有正当的理由，你就可以向 Vim 的作者 Bram 提交改进版本，或是对全新的语言的支持。我就对若干种文件类型提交过补丁，新增了对《计算机编程艺术》中的 MIX 汇编语言的语法支持，并维护着微软宏汇编（MASM）的语法文件。</p>
<p>在图形界面的 Vim 里，你可以通过“语法 &gt; 在菜单中显示文件类型”（“Syntax &gt; Show File Types in Menu”）来展示 Vim 的所有文件类型，然后可以选择某一类型来对当前文件进行设置。这儿的菜单项，跟 syntax 目录下的文件就基本是一一对应的了。</p>
<p>在菜单中显示文件类型这个额外的步骤，可能是因为很久很久以前，加载所有文件类型的菜单是一个耗时的操作吧。在 menu.vim 里，目前有这样的代码：</p>
<pre><code>" Skip setting up the individual syntax selection menus unless
" do_syntax_sel_menu is defined (it takes quite a bit of time).
if exists("do_syntax_sel_menu")
  runtime! synmenu.vim
else
  …
endif
</code></pre>
<p>不知道这段注释是什么年代加上的……但显然，我们的电脑已经不会再在乎加载几百个菜单项所占的时间了。即使我不怎么用菜单，我也找不出不直接展示这个菜单的理由；我可不想在需要使用的时候再多点一次鼠标。</p>
<p>所以，我会在我的 vimrc 文件里写上：</p>
<pre><code>let do_syntax_sel_menu = 1
</code></pre>
<p>同理，我会加载其他一些可能会被 Vim 延迟加载的菜单，减少需要在菜单上点击的次数：</p>
<pre><code>let do_no_lazyload_menus = 1
</code></pre>
<p>上面两个设置在我的机器上会让我打开 Vim 的速度下降大概 20 毫秒。我想我不在乎这点时间差异……</p>
<p>我们用“<code>:help</code>”命令查看的帮助文件就放在 doc 目录下。我们可以用菜单“编辑 &gt; 配色方案”（“Edit &gt; Color Scheme”）浏览配色方案，相应的文件就在 colors 目录下。</p>
<p>在 plugin 目录下的系统内置插件不多，我们下面就快速讲解一下：</p>
<ul>
<li>getscriptPlugin：获得最新的 Vim 脚本的插件（在目前广泛使用 Git 的年代，这个插件过时了，我们不讲）</li>
<li>gzip：编辑 .gz 压缩文件（能在编辑后缀为 .gz 的文件时自动解压和压缩，你会感觉不到这个文件是压缩的）</li>
<li>logiPat：模式匹配的逻辑运算符（允许以逻辑运算、而非标准正则表达式的方式来写模式匹配表达式）</li>
<li>manpager：使用 Vim 来查看 man 帮助（强烈建议试一下，记得使用 Vim 的跳转键 <code>C-]</code> 和 <code>C-T</code>）</li>
<li>matchparen：对括号进行高亮匹配（现代编辑器基本都有类似的功能）</li>
<li>netrwPlugin：从网络上编辑文件和浏览（远程）目录（支持多种常见协议如 ftp 和 scp，可直接打开目录来选择文件）</li>
<li>rrhelper：用于支持 <code>--remote-wait</code> 编辑（Vim 的多服务器会用到这一功能）</li>
<li>spellfile：在拼写文件缺失时自动下载（Vim 一般只安装了英文的拼写文件）</li>
<li>tarPlugin：编辑（压缩的）tar 文件（注意，和 gzip 情况不同，这儿不支持写入）</li>
<li>tohtml：把语法加亮的结果转成 HTML（自己打开个文件，输入命令“<code>:TOhtml</code>”就知道效果了）</li>
<li>vimballPlugin：创建和解开 .vba 文件（这个目前也略过时了，我们不讲）</li>
<li>zipPlugin：编辑 zip 文件（和 tar 文件不同，zip 文件可支持写入）</li>
</ul>
<p>除了 rrhelper 和 spellfile 属于功能支持插件，没有自己的帮助页面，其他功能都可以使用“<code>:help</code>”命令来查看帮助。查看帮助时，插件名称中的“Plugin”后缀需要去掉：查看 zip 文件编辑的帮助时，应当使用“<a href="https://yianwillis.github.io/vimcdoc/doc/pi_zip.html#zip" target="_blank"><code>:help zip</code></a>”而不是“<code>:help zipPlugin</code>”。</p>
<p>从这些插件当中，我们已经可以看到 Vim 的一些特殊威力了吧。下面的动图里，我们可以看到部分插件功能的展示：</p>
<p><img alt="Fig4.1" src="assets/40016fac28fd6b3dd1361c4a9a39a07b.gif" title="浏览远程目录，打开一个 tar.gz 文件"/></p>
<p><img alt="Fig4.2" src="assets/f8675428065868331a7376a64f2143c2.gif" title="使用 Vim 查看 man 帮助"/></p>
<h3 id="用户的-vim-配置目录">用户的 Vim 配置目录</h3>
<p>Vim 的安装目录你是不应该去修改的。首先，你可能没有权限去修改这个目录；其次，即使你有修改权限，这个目录会在 Vim 升级时被覆盖，你做的修改也会丢失。用户自己的配置应当放在自己的目录下，这也就是用户自己的主目录下的 Vim 配置目录（Unix 下的 .vim，Windows 下的 vimfiles）。这个目录应和 Vim 安装目录下的运行支持文件目录有相同的结构，但下面的子目录你在需要修改 Vim 的相关行为时才有必要创建。如果一个同名文件出现用户自己的 Vim 配置目录里和 Vim 的安装目录里，用户的文件优先。</p>
<p>换句话说，修改 Vim 行为最简单的一种方式，就是把一个系统的运行支持文件复制到自己的 Vim 配置目录下的相同位置，然后修改其内容。我自己常常用这种方式来精调 Vim 的语法加亮。</p>
<p>显然，这种方式的缺点（在适当的时候也是优点）是，如果 Vim 的运行支持文件后来被修改/更新了，你也会继续使用你自己目录下的老版本修改版。如果你的修改不只是你自己的临时方案、同时也适合他人的话，最佳做法还是给 Vim 项目提交补丁，让其他所有人都能用上你的修改，这样才是开源的最佳使用方式。</p>
<p>关于 Vim 的公用脚本，这儿再多说几句。Vim 的网站过去是用来集中获取各种脚本——如插件和配色方案——的地方，而 getscriptPlugin 可以帮助简化这个过程。今天你仍然可以使用这个方法，但 Git 和 GitHub 的广泛使用已经改变了人们获取和更新脚本的方式。现在，最主流的分发 Vim 脚本的方式是利用 GitHub，而用户则使用包管理器来调用 Git 从 GitHub（或类似的 Git 库）获取和更新脚本，下面我们很快就会讲到。</p>
<p>理解了 Vim 的目录结构，我们接着来看 Vim 8 的新功能。</p>
<h2 id="vim-8-新功能">Vim 8 新功能</h2>
<p>Vim 是一个持续改进中的应用程序。从 Vim 8.1（2018 年 5 月 17 日）到 Vim 8.2（2019 年 12 月 12日），Vim 有 2424 个补丁，也就是说，平均每天超过 4 个补丁。很多 Vim 8 里的大功能，并不是一次性引入，而是在补丁中慢慢引入的。比如，Vim 里现在有终端支持，这个功能从 Vim 8.0.0693 开始引入，到了 Vim 8.1，成为一个正式的大功能。</p>
<p>站在我个人的角度看，从 Vim 7.4 到 Vim 8.2，最大的新功能是：</p>
<ul>
<li>Vim 软件包的支持（“<a href="https://yianwillis.github.io/vimcdoc/doc/repeat.html#packages" target="_blank"><code>:help packages</code></a>”）</li>
<li>异步任务支持（“<a href="https://yianwillis.github.io/vimcdoc/doc/channel.html" target="_blank"><code>:help channel</code></a>”、“<a href="https://yianwillis.github.io/vimcdoc/doc/channel.html#job" target="_blank"><code>:help job</code></a>”和“<a href="https://yianwillis.github.io/vimcdoc/doc/eval.html#timers" target="_blank"><code>:help timers</code></a>”）</li>
<li>终端支持（“<a href="https://yianwillis.github.io/vimcdoc/doc/terminal.html" target="_blank"><code>:help terminal</code></a>”）</li>
</ul>
<p>今天我们就重点讲一下 Vim 软件包。这是 Vim 8 里带来的一个重要功能，也让我们在扩展 Vim 的时候变得更方便了。</p>
<h3 id="vim-软件包">Vim 软件包</h3>
<p>Vim 的目录结构有点传统 Unix 式：一个功能用到的文件可能会分散在多个目录下。就像传统 Unix 上 Vim 的文件可能分散在 /usr/bin、/usr/share/man、/usr/share/vim 等目录下一样，一个 Vim 的插件（严格来讲，应该叫包）通常也会分散在多个目录下：</p>
<ul>
<li>插件的主体通常在 plugin 目录下</li>
<li>插件的帮助文件在 doc 目录下</li>
<li>有些插件只对某些文件类型有效，会有文件放在 ftplugin 目录下</li>
<li>有些插件有自己的文件类型检测规则，会有文件放在 ftdetect 目录下</li>
<li>有些插件有特殊的语法加亮，会有文件放在 syntax 目录下</li>
<li>……</li>
</ul>
<p>以前我们安装插件，一般是一次性安装后就不管了。安装过程基本上就是到 .vim 目录（Windows 上是 vimfiles 目录）下，解出压缩包的内容，然后执行 <code>vim -c 'helptags doc|q'</code> 生成帮助文件的索引。到了“互联网式更新”的年代，这种方式就显得落伍了。尤其糟糕的地方在于，它是按文件类型来组织目录的，而不是按相关性，这就没法用 Git 来管理了。</p>
<p>Vim 上后来就出现了一些包管理器，它们的基本模式都是相通的：每个包有自己的目录，然后这些目录会被加到 Vim 的运行时路径（<code>runtimepath</code>）选项里。最早的 <code>runtimepath</code> 较为简单，在 Unix 上缺省为：</p>
<blockquote>
<p><code>$HOME/.vim,</code>-
<code>$VIM/vimfiles,</code>-
<code>$VIMRUNTIME,</code>-
<code>$VIM/vimfiles/after,</code>-
<code>$HOME/.vim/after</code></p>
</blockquote>
<p>而在有了包管理器之后，<code>runtimepath</code> 就会非常复杂，每个包都会增加一个自己的目录进去。但是，好处也是非常明显的，包的管理变得非常方便。从 Vim 8 开始，Vim 官方也采用了类似的体系。Vim 会在用户的配置目录（Unix 下是 <code>$HOME/.vim</code> ，Windows 下是 <code>$HOME/vimfiles</code> ）下识别名字叫 pack 的目录，并在这个目录的子目录的 start 和 opt 目录下寻找包的目录。</p>
<p>听着有点绕吧？我们看一个实际的 Vim 配置目录的结构就清楚了：</p>
<pre><code>.
├── colors
├── doc
├── pack
│   ├── minpac
│   │   ├── opt
│   │   │   ├── minpac
│   │   │   ├── vim-airline
│   │   │   └── vimcdoc
│   │   └── start
│   │       ├── VimExplorer
│   │       ├── asyncrun.vim
│   │       ├── fzf.vim
│   │       ├── gruvbox
│   │       ├── killersheep
│   │       ├── nerdcommenter
│   │       ├── nerdtree
│   │       ├── tagbar
│   │       ├── undotree
│   │       ├── vim-fugitive
│   │       ├── vim-matrix-screensaver
│   │       ├── vim-rainbow
│   │       ├── vim-repeat
│   │       ├── vim-rhubarb
│   │       └── vim-surround
│   └── my
│       ├── opt
│       │   ├── YouCompleteMe
│       │   ├── ale
│       │   ├── clang_complete
│       │   ├── cvsmenu
│       │   └── syntastic
│       └── start
│           ├── vim-gitgutter
│           └── ycmconf
├── plugin
├── syntax
└── undodir
</code></pre>
<p>可以看到，pack 目录下有 minpac 和 my 两个子目录（这些名字 Vim 不关心），每个目录下面又有 opt 和 start 两个子目录，再下面就是每个包自己的目录了，里面又可以有自己的一套 colors、doc、plugin 这样的子目录，这样就方便管理了。Vim 8 在启动时会加载所有 pack/*/start 下面的包，而用户可以用 <code>:packadd</code> 命令来加载某个 opt 目录下的包，如 <code>:packadd vimcdoc</code> 命令可加载 vimcdoc 包，来显示中文帮助信息。</p>
<p>有了这样的目录结构，用户要自己安装、管理包就方便多了。不过，我们还是推荐使用一个包管理器。包管理器可以带来下面的好处：</p>
<ul>
<li>根据文本的配置（一般写在 vimrc 配置文件里）决定要安装哪些包</li>
<li>自动化安装、升级和卸载，包括帮助文件的索引生成</li>
</ul>
<p>在我们这门课程里，我会使用 minpac，一个利用 Vim 8 功能的小巧的包管理器。如果你已经在使用其他包管理器，我接下来讲的两个小节你可以考虑跳过。</p>
<h3 id="安装-minpac">安装 minpac</h3>
<p>根据 minpac 网页上的说明，我们在 Windows 下可以使用下面的命令：</p>
<pre><code>cd /d %USERPROFILE%
git clone https://github.com/k-takata/minpac.git ^
    vimfiles\pack\minpac\opt\minpac
</code></pre>
<p>在 Linux 和 macOS 下则可以使用下面的命令：</p>
<pre><code>git clone https://github.com/k-takata/minpac.git \
    ~/.vim/pack/minpac/opt/minpac
</code></pre>
<p>然后，我们在 vimrc 配置文件中加入以下内容（先不用理解其含义）：</p>
<pre><code>if exists('*minpac#init')
  " Minpac is loaded.
  call minpac#init()
  call minpac#add('k-takata/minpac', {'type': 'opt'})

  " Other plugins
endif

if has('eval')
  " Minpac commands
  command! PackUpdate packadd minpac | source $MYVIMRC | call minpac#update('', {'do': 'call minpac#status()'})
  command! PackClean  packadd minpac | source $MYVIMRC | call minpac#clean()
  command! PackStatus packadd minpac | source $MYVIMRC | call minpac#status()
endif
</code></pre>
<p>存盘、重启 Vim 之后，我们就有了三个新的命令，可以用来更新（安装）包、清理包和检查当前包的状态。</p>
<h3 id="通过-minpac-安装扩展包">通过 minpac 安装扩展包</h3>
<p>下面我们就来试验一下通过 minpac 来安装扩展包。我们在“Other plugins”那行下面加入以下内容：</p>
<pre><code>call minpac#add('tpope/vim-eunuch')
</code></pre>
<p>保存文件，然后我们使用 <code>:PackUpdate</code> 命令。略微等待之后，我们就能看到类似下面的界面：</p>
<p><img alt="Fig4.3" src="assets/10885cf1c7406883c70838015971fb4c.png" title="插件安装之后的状态界面"/></p>
<p>这就说明安装成功了。我们可以按 <code>q</code> 来退出这个状态窗口。</p>
<p>我们也可以使用 <code>:PackStatus</code> 来重新打开这个状态窗口。要删除一个插件，在 vimrc 中删除对应的那行，保存，然后使用 <code>:PackClean</code> 命令就可以了。愿意的话，你现在就可以试一下。</p>
<h3 id="最近使用的文件">最近使用的文件</h3>
<p>安装好 Vim 软件包之后，我们进一步来实现一个小功能。</p>
<p>Vim 的缺省安装缺了一个很多编辑器都有的功能：最近使用的文件。</p>
<p>我们就把这个功能补上吧。你只需要按照上一节的步骤安装 yegappan/mru 包就可以了（MRU 代表 most recently used）。安装完之后，重新打开 vimrc 文件，你就可以在图形界面里看到下面的菜单了：</p>
<p><img alt="Fig4.4" src="assets/2c44030349043755a98f9e237ae534d6.png" title="最近文件的菜单"/></p>
<p>估计你很可能会问：如果是远程连接，没有图形界面怎么办？</p>
<p>我们仍可以在文本界面上唤起菜单，虽然美观程度会差点。你需要在 vimrc 配置文件中加入以下内容（同样，我们暂时先不用去理解其意义）：</p>
<pre><code>if !has('gui_running')
  " 设置文本菜单
  if has('wildmenu')
    set wildmenu
    set cpoptions-=&lt;
    set wildcharm=&lt;C-Z&gt;
    nnoremap &lt;F10&gt;      :emenu &lt;C-Z&gt;
    inoremap &lt;F10&gt; &lt;C-O&gt;:emenu &lt;C-Z&gt;
  endif
endif
</code></pre>
<p>在增加上面的配置之后，你就可以使用键 <code>&lt;F10&gt;</code>（当然你也可以换用其他键）加 <code>&lt;Tab&gt;</code> 来唤起 Vim 的文本菜单了。如下图所示：</p>
<p><img alt="Fig4.5" src="assets/f4435e4c42a7cf2be74f563e4f0b0fd8.gif" title="文本菜单的使用"/></p>
<h2 id="内容小结">内容小结</h2>
<p>本讲我们讨论了 Vim 8 下的基本目录结构和 Vim 8 的软件包。</p>
<p>你需要知道，Vim 的运行支持目录和用户配置目录有相似的结构，用户配置目录下的文件优先于 Vim 安装目录下的文件。因此，在用户配置目录里进行修改，可以在 Vim 版本有变化时保留自己的定制行为。</p>
<p>而 Vim 8 的软件包使得维护 Vim 的扩展变得更为容易，每一个 Vim 软件包都是独立的目录，可以单独安装、修改和升级。包管理器，如 minpac，则可以帮助我们更方便地安装和管理 Vim 软件包。</p>
<p>对于配置文件，适用于本讲的内容标签是 <code>l4-unix</code> 和 <code>l4-windows</code>。</p>
<h2 id="课后练习">课后练习</h2>
<p>请仔细查看一下你的 Vim 安装目录下面的目录结构，对 Vim 的目录结构有一个直观的理解。你也可以打开一些 .vim 文件来看看，初步感受一下 Vim 脚本：如 filetype.vim 里有着 Vim 如何识别文件类型的逻辑，值得大致了解一下——Vim 并不仅仅是用后缀来判断文件类型的！</p>
<p>另外，一定要根据文中的说明，实践一下安装 minpac，及使用 minpac 来安装其他 Vim 软件包（除非你已经在使用另外一个包管理器了）。我们后面会经常性地安装新的软件包，这一部分操作一定需要牢牢掌握。</p>
<p>如有任何问题，请留言和我交流、讨论。我们下一讲见！</p>
</div>
</div>
<div>
<div id="prePage" style="float: left">
</div>
<div id="nextPage" style="float: right">
</div>
</div>
</div>
</div>
</div>
<div class="copyright">
<hr/>
<p>© 2019 - 2023 <a href="/cdn-cgi/l/email-protection#cba7a7a7f2fffafafbfc8baca6aaa2a7e5a8a4a6" target="_blank">Liangliang Lee</a>.
                    Powered by <a href="https://github.com/gin-gonic/gin" target="_blank">gin</a> and <a href="https://github.com/kaiiiz/hexo-theme-book" target="_blank">hexo-theme-book</a>.</p>
</div>
</div>
<a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9358fce9badc5773',t:'MTc0NTUzMzIyNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NPSEEVD756"></script>
<script src="/static/index.js"></script>
</head></html>