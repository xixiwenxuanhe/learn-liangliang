<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<meta content="zh-cn" http-equiv="content-language"/>
<meta content="14 可观测（下）： 如何构建多维度视角下的Serverless监测体系？" name="description"/>
<link href="/static/favicon.png" rel="icon"/>
<title>14 可观测（下）： 如何构建多维度视角下的Serverless监测体系？ </title>
<link href="/static/index.css" rel="stylesheet"/>
<link href="/static/highlight.min.css" rel="stylesheet"/>
<script src="/static/highlight.min.js"></script>
<meta content="Hexo 4.2.0" name="generator"/>
<script data-website-id="83e5d5db-9d06-40e3-b780-cbae722fdf8c" defer="" src="https://umami.lianglianglee.com/script.js"></script>
</head>
<body>
<div class="book-container">
<div class="book-sidebar">
<div class="book-brand">
<a href="/">
<img src="/static/favicon.png"/>
<span>技术文章摘抄</span>
</a>
</div>
<div class="book-menu uncollapsible">
<ul class="uncollapsible">
<li><a class="current-tab" href="/">首页</a></li>
<li><a href="../">上一级</a></li>
</ul>
<ul class="uncollapsible">
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/00%20%e5%bc%80%e7%af%87%e8%af%8d%20Serverless%e6%98%af%e9%99%8d%e6%9c%ac%e5%a2%9e%e6%95%88%e6%b5%aa%e6%bd%ae%e4%b8%8b%e7%9a%84%e5%bf%85%e7%84%b6%e9%80%89%e6%8b%a9.md.html" id="00 开篇词 Serverless是降本增效浪潮下的必然选择.md.html">00 开篇词 Serverless是降本增效浪潮下的必然选择.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/00%20%e6%80%9d%e7%bb%b4%e6%9e%84%e5%bb%ba%20%e5%a6%82%e4%bd%95%e5%9c%a8%e6%96%b0%e8%b5%9b%e9%81%93%e4%b8%8b%e8%bf%9b%e9%98%b6Serverless%e8%83%bd%e5%8a%9b%ef%bc%9f.md.html" id="00 思维构建 如何在新赛道下进阶Serverless能力？.md.html">00 思维构建 如何在新赛道下进阶Serverless能力？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/01%20%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%ef%bc%9a%e5%87%bd%e6%95%b0%e8%ae%a1%e7%ae%97%e7%9a%84%e5%9f%ba%e6%9c%ac%e6%b5%81%e7%a8%8b%e6%98%af%e5%a6%82%e4%bd%95%e6%89%a7%e8%a1%8c%e7%9a%84%ef%bc%9f.md.html" id="01 生命周期：函数计算的基本流程是如何执行的？.md.html">01 生命周期：函数计算的基本流程是如何执行的？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/02%20%e8%a7%a6%e5%8f%91%e5%99%a8%ef%bc%9a%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%ba%8b%e4%bb%b6%e6%ba%90%e4%b8%8e%e5%87%bd%e6%95%b0%e8%ae%a1%e7%ae%97%e7%9a%84%e7%ba%bd%e5%b8%a6%ef%bc%9f.md.html" id="02 触发器：如何构建事件源与函数计算的纽带？.md.html">02 触发器：如何构建事件源与函数计算的纽带？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/03%20%e9%ab%98%e7%ba%a7%e5%b1%9e%e6%80%a7%ef%bc%9a%e5%ba%94%e5%af%b9%e7%94%9f%e4%ba%a7%e7%ba%a7%e5%88%ab%e7%9a%84%e5%ba%94%e7%94%a8%ef%bc%8c%e4%bd%a0%e9%9c%80%e8%a6%81%e6%8e%8c%e6%8f%a1%e5%93%aa%e4%ba%9b%e6%8a%80%e8%83%bd%ef%bc%9f.md.html" id="03 高级属性：应对生产级别的应用，你需要掌握哪些技能？.md.html">03 高级属性：应对生产级别的应用，你需要掌握哪些技能？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/04%20%e5%86%b7%e5%90%af%e5%8a%a8%ef%bc%9a%e5%a6%82%e4%bd%95%e5%8a%a0%e5%bf%ab%e5%87%bd%e6%95%b0%e7%9a%84%e7%ac%ac%e4%b8%80%e6%ac%a1%e8%b0%83%e7%94%a8%e8%bf%87%e7%a8%8b%ef%bc%9f.md.html" id="04 冷启动：如何加快函数的第一次调用过程？.md.html">04 冷启动：如何加快函数的第一次调用过程？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/05%20%e6%89%a9%e7%bc%a9%e5%ae%b9%ef%bc%9a%e5%a6%82%e4%bd%95%e5%ba%94%e5%af%b9%e6%b5%81%e9%87%8f%e7%9a%84%e6%b3%a2%e5%b3%b0%e6%b3%a2%e8%b0%b7%ef%bc%9f.md.html" id="05 扩缩容：如何应对流量的波峰波谷？.md.html">05 扩缩容：如何应对流量的波峰波谷？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/06%20%e6%b5%81%e9%87%8f%e8%bd%ac%e5%8f%91%ef%bc%9a%e5%87%bd%e6%95%b0%e5%9c%a8%e4%b8%8d%e5%90%8c%e6%83%85%e5%bd%a2%e4%b8%8b%e6%98%af%e5%a6%82%e4%bd%95%e6%89%a7%e8%a1%8c%e7%9a%84%ef%bc%9f.md.html" id="06 流量转发：函数在不同情形下是如何执行的？.md.html">06 流量转发：函数在不同情形下是如何执行的？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/07%20%e8%bf%90%e8%a1%8c%e6%97%b6%ef%bc%88%e4%b8%8a%ef%bc%89%ef%bc%9a%e4%b8%8d%e5%90%8c%e8%af%ad%e8%a8%80%e5%bd%a2%e6%80%81%e4%b8%8b%e7%9a%84%e5%87%bd%e6%95%b0%e5%9c%a8%e5%ae%b9%e5%99%a8%e4%b8%ad%e6%98%af%e5%a6%82%e4%bd%95%e6%89%a7%e8%a1%8c%e7%9a%84%ef%bc%9f.md.html" id="07 运行时（上）：不同语言形态下的函数在容器中是如何执行的？.md.html">07 运行时（上）：不同语言形态下的函数在容器中是如何执行的？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/08%20%e8%bf%90%e8%a1%8c%e6%97%b6%ef%bc%88%e4%b8%8b%ef%bc%89%ef%bc%9a%e4%b8%8d%e5%90%8c%e8%af%ad%e8%a8%80%e5%bd%a2%e6%80%81%e4%b8%8b%e7%9a%84%e5%87%bd%e6%95%b0%e5%9c%a8%e5%ae%b9%e5%99%a8%e4%b8%ad%e6%98%af%e5%a6%82%e4%bd%95%e6%89%a7%e8%a1%8c%e7%9a%84%ef%bc%9f.md.html" id="08 运行时（下）：不同语言形态下的函数在容器中是如何执行的？.md.html">08 运行时（下）：不同语言形态下的函数在容器中是如何执行的？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/09%20%e5%b0%8f%e8%af%95%e7%89%9b%e5%88%80%ef%bc%88%e4%b8%80%ef%bc%89%ef%bc%9a%e5%a6%82%e4%bd%95%e5%88%a9%e7%94%a8%e5%87%bd%e6%95%b0%e4%b9%8b%e9%97%b4%e7%9a%84%e8%b0%83%e7%94%a8%e8%a7%a3%e5%86%b3%e4%b8%9a%e5%8a%a1%e9%97%ae%e9%a2%98%ef%bc%9f.md.html" id="09 小试牛刀（一）：如何利用函数之间的调用解决业务问题？.md.html">09 小试牛刀（一）：如何利用函数之间的调用解决业务问题？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/10%20%e5%b0%8f%e8%af%95%e7%89%9b%e5%88%80%ef%bc%88%e4%ba%8c%ef%bc%89%ef%bc%9a%e5%a6%82%e4%bd%95%e7%aa%81%e7%a0%b4VPC%e7%bd%91%e7%bb%9c%e7%9a%84%e9%80%9f%e5%ba%a6%e9%99%90%e5%88%b6%ef%bc%9f.md.html" id="10 小试牛刀（二）：如何突破VPC网络的速度限制？.md.html">10 小试牛刀（二）：如何突破VPC网络的速度限制？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/11%20WebIDE%ef%bc%9a%e5%a6%82%e4%bd%95%e8%ae%a9%e5%87%bd%e6%95%b0%e8%bf%9c%e7%a6%bb%e7%b9%81%e7%90%90%e7%9a%84%e6%9c%ac%e5%9c%b0%e5%bc%80%e5%8f%91%e6%a8%a1%e5%bc%8f%ef%bc%9f.md.html" id="11 WebIDE：如何让函数远离繁琐的本地开发模式？.md.html">11 WebIDE：如何让函数远离繁琐的本地开发模式？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/12%20%e7%bc%96%e6%8e%92%ef%bc%9a%e5%a6%82%e4%bd%95%e5%8d%8f%e8%b0%83%e5%a4%9a%e4%bb%bb%e5%8a%a1%e7%9a%84%e8%bf%90%e8%a1%8c%ef%bc%9f.md.html" id="12 编排：如何协调多任务的运行？.md.html">12 编排：如何协调多任务的运行？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/13%20%e5%8f%af%e8%a7%82%e6%b5%8b%ef%bc%88%e4%b8%8a%ef%bc%89%ef%bc%9a%20%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e5%a4%9a%e7%bb%b4%e5%ba%a6%e8%a7%86%e8%a7%92%e4%b8%8b%e7%9a%84Serverless%e7%9b%91%e6%b5%8b%e4%bd%93%e7%b3%bb%ef%bc%9f.md.html" id="13 可观测（上）： 如何构建多维度视角下的Serverless监测体系？.md.html">13 可观测（上）： 如何构建多维度视角下的Serverless监测体系？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/14%20%e5%8f%af%e8%a7%82%e6%b5%8b%ef%bc%88%e4%b8%8b%ef%bc%89%ef%bc%9a%20%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e5%a4%9a%e7%bb%b4%e5%ba%a6%e8%a7%86%e8%a7%92%e4%b8%8b%e7%9a%84Serverless%e7%9b%91%e6%b5%8b%e4%bd%93%e7%b3%bb%ef%bc%9f.md.html" id="14 可观测（下）： 如何构建多维度视角下的Serverless监测体系？.md.html">14 可观测（下）： 如何构建多维度视角下的Serverless监测体系？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/15%20%e9%80%89%e5%9e%8b%ef%bc%9a%e4%b8%8d%e5%90%8c%e9%98%b6%e6%ae%b5%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%94%e5%a6%82%e4%bd%95%e5%ad%98%e5%82%a8%ef%bc%9f.md.html" id="15 选型：不同阶段的数据应如何存储？.md.html">15 选型：不同阶段的数据应如何存储？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/16%20%e5%8a%a8%e6%89%8b%e4%bd%93%e9%aa%8c%ef%bc%88%e4%b8%80%ef%bc%89%ef%bc%9a%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e4%b8%9a%e5%8a%a1%e9%ab%98%e6%95%88%e7%8e%87%e5%9c%b0%e5%bc%80%e5%8f%91%e4%b8%8a%e7%ba%bf%ef%bc%9f.md.html" id="16 动手体验（一）：如何实现业务高效率地开发上线？.md.html">16 动手体验（一）：如何实现业务高效率地开发上线？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/17%20%e5%8a%a8%e6%89%8b%e4%bd%93%e9%aa%8c%ef%bc%88%e4%ba%8c%ef%bc%89%ef%bc%9a%e5%a6%82%e4%bd%95%e5%9c%a8%e4%ba%91%e5%87%bd%e6%95%b0%e5%9c%ba%e6%99%af%e4%b8%8b%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%e6%9c%89%e7%8a%b6%e6%80%81%e7%9a%84%e6%9c%8d%e5%8a%a1%ef%bc%9f.md.html" id="17 动手体验（二）：如何在云函数场景下实现一个有状态的服务？.md.html">17 动手体验（二）：如何在云函数场景下实现一个有状态的服务？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/18%20%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97%ef%bc%9aServerless%e6%b2%99%e5%9c%ba%e8%80%81%e5%85%b5%e7%9a%84%e4%b8%80%e7%ba%bf%e4%bd%bf%e7%94%a8%e7%bb%8f%e9%aa%8c.md.html" id="18 实战指南：Serverless沙场老兵的一线使用经验.md.html">18 实战指南：Serverless沙场老兵的一线使用经验.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/19%20%e5%ae%9e%e6%88%98%e8%bf%9b%e9%98%b6%ef%bc%88%e4%b8%80%ef%bc%89%ef%bc%9aServerless%20%e2%80%9c%e8%bf%9e%e6%8e%a5%e5%99%a8%e2%80%9d%20%e7%9a%84%e8%83%bd%e5%8a%9b%e5%88%b0%e5%ba%95%e6%9c%89%e5%a4%9a%e5%a4%a7%ef%bc%9f.md.html" id="19 实战进阶（一）：Serverless “连接器” 的能力到底有多大？.md.html">19 实战进阶（一）：Serverless “连接器” 的能力到底有多大？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/20%20%e5%ae%9e%e6%88%98%e8%bf%9b%e9%98%b6%ef%bc%88%e4%ba%8c%ef%bc%89%ef%bc%9a%e5%a6%82%e4%bd%95%e5%9f%ba%e4%ba%8e%e6%99%ba%e8%83%bd%e9%9f%b3%e7%ae%b1%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aaBOT%e6%8a%80%e8%83%bd%ef%bc%9f.md.html" id="20 实战进阶（二）：如何基于智能音箱开发一个BOT技能？.md.html">20 实战进阶（二）：如何基于智能音箱开发一个BOT技能？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/21%20%e5%ae%9e%e6%88%98%e8%bf%9b%e9%98%b6%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e4%bc%a0%e7%bb%9f%e7%9a%84%e6%9c%8d%e5%8a%a1%e5%a6%82%e4%bd%95%e8%bf%81%e7%a7%bb%e5%88%b0Serverless%e5%b9%b3%e5%8f%b0%ef%bc%9f.md.html" id="21 实战进阶（三）：传统的服务如何迁移到Serverless平台？.md.html">21 实战进阶（三）：传统的服务如何迁移到Serverless平台？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/22%20%e7%a7%81%e6%9c%89%e4%ba%91%ef%bc%9a%e8%b5%9b%e9%a9%ac%e6%97%b6%e4%bb%a3%e7%9a%84Serverless%e6%a0%b8%e5%bf%83%e5%bc%95%e6%93%8e%e8%b0%81%e8%83%bd%e8%83%9c%e5%87%ba%ef%bc%9f.md.html" id="22 私有云：赛马时代的Serverless核心引擎谁能胜出？.md.html">22 私有云：赛马时代的Serverless核心引擎谁能胜出？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/23%20%e5%ae%9e%e6%88%98%e8%bf%9b%e9%98%b6%ef%bc%88%e5%9b%9b%ef%bc%89%ef%bc%9a%e5%a6%82%e4%bd%95%e4%bb%8e0%e5%88%b01%e8%bf%9b%e9%98%b6%e4%b8%80%e4%b8%aa%e5%bc%80%e6%ba%90%e5%bc%95%e6%93%8e%ef%bc%9f.md.html" id="23 实战进阶（四）：如何从0到1进阶一个开源引擎？.md.html">23 实战进阶（四）：如何从0到1进阶一个开源引擎？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/24%20%e5%ae%9e%e6%88%98%e8%bf%9b%e9%98%b6%ef%bc%88%e4%ba%94%ef%bc%89%ef%bc%9a%e5%a6%82%e4%bd%95%e4%bb%8eServerless%e5%bc%95%e6%93%8e%e8%9c%95%e5%8f%98%e6%88%90%e4%b8%80%e4%b8%aaServerless%e5%b9%b3%e5%8f%b0%ef%bc%9f.md.html" id="24 实战进阶（五）：如何从Serverless引擎蜕变成一个Serverless平台？.md.html">24 实战进阶（五）：如何从Serverless引擎蜕变成一个Serverless平台？.md.html</a>
</li>
<li>
<a class="menu-item" href="/%e4%b8%93%e6%a0%8f/Serverless%e8%bf%9b%e9%98%b6%e5%ae%9e%e6%88%98%e8%af%be/%e7%bb%93%e6%9d%9f%e8%af%ad%20%e5%9c%a8%e5%ae%9e%e6%88%98%e4%b8%ad%e6%8a%8a%e6%8f%a1%e4%ba%8b%e7%89%a9%e6%9c%ac%e8%b4%a8%ef%bc%8c%e4%b8%8d%e6%96%ad%e9%9d%a9%e6%96%b0.md.html" id="结束语 在实战中把握事物本质，不断革新.md.html">结束语 在实战中把握事物本质，不断革新.md.html</a>
</li>
<li><a href="/assets/捐赠.md.html">捐赠</a></li>
</ul>
</div>
</div>
<div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseleave="remove_inner()" onmouseover="add_inner()">
<div class="sidebar-toggle-inner"></div>
</div>
<div class="off-canvas-content">
<div class="columns">
<div class="column col-12 col-lg-12">
<div class="book-navbar">
<header class="navbar">
<section class="navbar-section">
<a onclick="open_sidebar()">
<i class="icon icon-menu"></i>
</a>
</section>
</header>
</div>
<div class="book-content" style="max-width: 960px; margin: 0 auto;
    overflow-x: auto;
    overflow-y: hidden;">
<div class="book-post">
<div align="center">因收到Google相关通知，网站将会择期关闭。<a href="https://lumendatabase.org/notices/44265620" target="_blank">相关通知内容</a><hr/></div>
<p align="center" id="tip"></p>
<h1 class="title" data-id="14 可观测（下）： 如何构建多维度视角下的Serverless监测体系？" id="title">14 可观测（下）： 如何构建多维度视角下的Serverless监测体系？</h1>
<div><p>你好，我是静远。</p>
<p>上一节课，我们一起梳理了Serverless下可观测的重要性和构建可观测监测体系的要点，也结合案例，学习了指标的收集方法，了解了FaaS形态下指标上报的架构设计和注意事项。</p>
<p>今天这节课，我们继续来看可观测的另外两个数据支柱：日志和链路追踪。</p>
<h2 id="日志">日志</h2>
<p>我们知道，通常在运维一个系统的时候，从监控大盘了解问题的大致轮廓后，经常会根据日志去查看具体的错误细节。</p>
<p>日志的作用是记录离散事件，并通过分析这些记录了解程序的整体行为，比如出现过哪些关键数据，调用过哪些方法。也就是说，它能够帮我们定位问题的根源。</p>
<p>在函数计算场景下，我们需要考虑到用户日志与系统日志两种类型。其中，用户日志记录的主要是用户函数代码中业务流程发生的过程。这部分日志信息是在函数维度上独立收集的，并且用户可以通过前端控制台查看相关日志信息。而系统日志，则是整个平台侧发生事件的信息记录，最终汇总在一起，供平台侧的运维或开发人员排查问题。</p>
<h3 id="日志数据源">日志数据源</h3>
<p>那么日志应该什么时候打印又应该怎么打印呢？</p>
<p>首先，<strong>我们</strong><strong>需要</strong><strong>明确日志的级别</strong>。以系统日志为例，常见的包括Error、Info和Warn，分别表示错误日志、信息日志以及警告日志，在开发调试过程中可能还会用到Debug类型。我们需要根据实际的执行逻辑来设定不同的等级。</p>
<p>其次，在添加日志时，我们要<strong>尽可能</strong><strong>地收敛</strong><strong>错误信息</strong>，尽量避免重复信息的打印，因为频繁的IO不仅会加大日志采集的工作量，更会影响服务性能。</p>
<p>再次，<strong>日志应该尽量打在每个服务模块的入口和出口</strong>，服务内方法之间的调用和错误信息，也应该尽量通过传递的方式上报，而不是每个方法内都打印一条日志。</p>
<p>比如函数计算中请求的调度过程。调度模块中可能涉及到获取元信息、鉴权、并发度限制、获取函数实例信息等等一系列串行过程，每一个过程都可能包含多个方法之间的调用，其中任意一步出现问题都会导致调度失败。那么，我们在开发时就要尽可能给每个方法都添加一个error类型的返回值，在出现错误后，只需按照递归调用栈逐级返回，最终在入口处打印一条即可。这样可以有效减少重复信息的打印次数。</p>
<p>另外，对于函数开发者用到的用户日志，我也有两条使用上的建议。</p>
<p>一方面，<strong>减少print的使用，控制整体的信息大小</strong><strong>。</strong>为了方便在函数这个黑盒中快速定位问题，一些开发者习惯性地将print当成Debug工具来使用，但因为平台侧都会对单次的函数执行日志有一定限制，所以在函数开发过程中应该尽量减少无用信息的打印。</p>
<p>另一方面，<strong>关注Event。</strong>Event作为函数入口的基本传参，携带了请求源的关键信息，关注Event，也可以方便后续的溯源。</p>
<h3 id="日志的采集与清洗">日志的采集与清洗</h3>
<p>有了日志数据后，我们就可以进行收集了。</p>
<p>系统日志的数据都会写入到固定路径的文件中，而用户日志，通常都是采用DaemonSet日志组件进行收集。所以，一般函数实例内的日志文件都会存放在节点的挂载路径下，或者是集群内的持久卷中。</p>
<p>前面我们也提到用户日志是以函数为粒度的，而为了缓解不断增长的日志数据造成的节点磁盘的压力，通常会一次请求对应一个日志文件，请求结束则上报并删除文件内容。而系统日志则可以通过设置“定时删除任务”来处理。</p>
<p>在开源日志收集器的选型上，常用的有Logstash，Fluentd，Fluent-Bit以及Vector等比较不错的采集工具，他们之间各有不同的优势。</p>
<p>具体的对比，你可以参考Stela Udovicic 2021年12月在<a href="https://era.co/blog/choose-open-source-log-collector" target="_blank">ERA Software’s blog</a>的文章，她指出，我们很难找到一个完美的日志收集器，选择正确的日志收集器主要取决于你自己的特定需求。</p>
<p>比如，如果你需要资源占用较少的日志收集器，那么使用Vector或者Fluent-Bit就是一个不错的选择，而不是占用资源较高的Logstash。如果你需要寻找不具供应商色彩的收集器，那么Fluentd和Fluent-Bit是不错的选择。</p>
<p>在函数计算平台的构建中，通常我们会结合这几种工具的能力共同部署，你也可以根据具体的业务情况自己选择。这里，为了便于你理解他们各自的优势，我画了一个示意图，来看一下数据采集的具体流程。</p>
<p><img alt="图片" src="assets/aeadd6ce983c498f85a4c3a8a44f82c3.jpg"/></p>
<p>在采集数据时，由于Fluent-Bit在Kubernetes集群等容器化环境中的运行比较出色，所以通常我们会使用轻量的Fluent-Bit对日志数据进行整体的上报，如果是集群的日志信息，则会以DaemonSet的形式部署。</p>
<p>因为Logstash过滤功能强大，但资源耗费多，所以并不能像Fluent-Bit那样以DaemonSet的形式部署在整个集群，只需部署少量虚机实例，并利用Logstash进行整体的数据清洗即可。</p>
<p>如果考虑到峰值问题，比如前面提到的某一时刻存在请求高峰导致日志量显著增大，也可以利用kafka缓冲一轮。最后，再由Logstash将过滤后的数据交由相应的存储服务。</p>
<h3 id="日志的存储与检索">日志的存储与检索</h3>
<p>最后，我们再说日志的存储和检索。</p>
<p><img alt="图片" src="assets/763f10efb868446bb44c2e4ea48f1563.jpg"/></p>
<p>Logstash支持丰富的插件，除了可以支持像kafka、本地文件等多种数据输入源，输出的部分同样也支持与Elasticsearch、对象存储等多种数据存储服务的对接。</p>
<p>其中，Elasticsearch是一个分布式、高扩展、高实时的搜索与数据分析引擎，配合Kibana这种数据可视化工具，能快速搜索和分析我们上传的日志。</p>
<p>为了方便利用Kibana进行快速筛查，我们在日志打印阶段就应该以键值对的形式标记出关键信息，这样就可以在Kibana根据key进行筛查，比如：</p>
<pre><code class="language-yaml">{
    "level":"info",            //日志等级
    "ts":1657957846.7413378,   // 时间戳
    "caller":"apiserver/handler.go:154", // 调用的代码行数
    "msg":"service start", // 关键信息
    "request_id":"41bae18f-a083-493f-af43-7c3aed7ec53c",
    "service":"apiserver"  // 服务名称
}
 
</code></pre>
<p>另外，如果需要对日志文件进行溯源，或者需要考虑为函数计算平台拓展一些长期的数据报表功能，也可以让Logstash对接一个对象存储服务。</p>
<h2 id="链路">链路</h2>
<p>了解了指标和日志两个可观测数据之后，我们再去看第三个数据，链路。</p>
<p>除了代码出错，在一些延迟敏感的场景下，性能分析也是必不可少的，尤其是函数计算这种架构复杂，模块交互较多的服务。这个时候，链路追踪功能就派上了用场。</p>
<p>在函数计算场景下，它不仅可以提高函数计算系统的可观察性，帮助系统管理员检测、诊断系统的性能问题以保证预期的服务水平，还可以帮助开发者追踪函数的执行过程，快速分析、诊断函数计算架构下的调用关系及性能瓶颈，提高开发和诊断效率。</p>
<h3 id="链路信息">链路信息</h3>
<p>我们先说链路信息的获取。对用户而言，更关心的是端到端的整体耗时，而除了代码本身的执行，其余耗时主要发生在<a href="https://time.geekbang.org/column/article/563691" target="_blank">冷启动</a>的准备阶段。因此，平台可以默认提供给用户函数总耗时以及冷启动过程的耗时，其中也可以包括准备代码、运行时初始化等步骤的耗时。</p>
<p>而在复杂的业务场景中，往往会涉及到函数与函数或者函数与其他云服务之间的调用。这时，我们可以为开发者提供自定义的链路支持，将链路信息记录在相应的结构体中（如Header），就可以完整地串联起整个外部的调用链路。而内部的调用链路，也可以通过上下文的形式用SDK去处理。</p>
<p>通过这种与内置链路结合的方式，平台可以有效地帮助用户定位出超时、性能瓶颈以及涉及多个云服务关联等类似的故障问题。</p>
<p>在平台层面，则可以根据模块之间的关系以及系统架构的实际情况来构建链路，整体思路和用户侧的链路构建差不多。不过需要注意的是，并不是链路信息越详细越好，因为链路追踪本身也需要耗费一定资源，所以最好根据实际的运维需求来构建。</p>
<h3 id="链路拓扑的可视化">链路拓扑的可视化</h3>
<p>那么，我们如何追踪链路信息并友好地展示出来呢？常用的解决方案，一般是基于标准的OpenTelemetry协议，利用其提供的SDK和Otel Agent完成对链路Span的生成、传播和上报，最终通过分布式追踪系统（如Jaeger）进行收集，形成链路拓扑的可视化。</p>
<p>结合函数计算的特点，这里我也给出了一个基本的链路追踪功能架构图供你参考。从图中可以看出，OpenTelemetry可以通过三种方式来上报链路信息，包括直接使用SDK、Agent Sidecar和Agent DaemonSet，你可以根据自己的业务情况选择一种，或者多种组合方式。</p>
<p><img alt="图片" src="assets/ebf1102978274007ad28309f0020db2c.jpg"/></p>
<p>以Jaeger为例，节点服务可以使用Opentelemetry 的SDK或者Agent上报链路信息，通过Jaeger Collector统一收集，并由ElasticSearch进行存储，最终由Jaeger-Query负责展示数据查找。</p>
<p>到这里，我们来解答一下上一节课的课后思考题，Metrics指标数据是否也可以用此方式来收集呢？完全可以，基于Otel Agent，我们可以将数据发往Kafka、Promethues等数据存储后端的Backends。</p>
<h2 id="小结">小结</h2>
<p>最后，我来小结一下这两节课的内容。这两节课，我们一直在讨论函数计算平台下可观测体系的解决方案。我们可以按照可观测中指标、日志和链路这三要素的架构去构建解决方案。</p>
<p>首先，监控指标是指对系统中某一类信息的统计聚合。在函数计算平台上的监控，不仅需要考虑常见资源指标，比如CPU、Memory利用率等，还需要考虑用户实际关心的业务指标，比如函数调用次数、错误次数、执行时间等。</p>
<p>再说日志的构建。日志起到的作用，更像是在“保留现场”。通过日志，我们可以分析出程序的行为，比如曾经调用过什么方法，操作过哪些数据等。在打印日志时，我们也需要关注函数在关键节点上的输出。</p>
<p>最后，链路的追踪是通过对请求打标、透传、串联还原完整的请求过程。追踪主要是为了排障和优化，比如分析调用链的哪一部分、哪个方法出现了错误或阻塞，输入输出是否符合预期等。服务之间的链路信息耶可以通过Header进行传递，而整个数据过程其实和日志采集类似。但从形态上来看，<strong>日志更像是离散的事件，而链路追踪更像是连续的事件</strong>。</p>
<h2 id="思考题">思考题</h2>
<p>好了，这节课到这里也就结束了，最后我给你留了一个思考题。</p>
<p>随着OpenTelemetry的盛行，原则上使用一套Library或SDK，就可以自动地收集三种数据，然后由统一的Collector处理，但实际应用中，还会受限于新老系统、Otel的成熟度，你是怎么处理的？</p>
<p>欢迎在留言区写下你的思考和答案，我们一起交流讨论。感谢你的阅读，也欢迎你把这节课分享给更多的朋友一起交流学习。</p>
</div>
</div>
<div>
<div id="prePage" style="float: left">
</div>
<div id="nextPage" style="float: right">
</div>
</div>
</div>
</div>
</div>
<div class="copyright">
<hr/>
<p>© 2019 - 2023 <a href="/cdn-cgi/l/email-protection#127e7e7e2b262323222552757f737b7e3c717d7f" target="_blank">Liangliang Lee</a>.
                    Powered by <a href="https://github.com/gin-gonic/gin" target="_blank">gin</a> and <a href="https://github.com/kaiiiz/hexo-theme-book" target="_blank">hexo-theme-book</a>.</p>
</div>
</div>
<a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'935a13e83d548242',t:'MTc0NTU0NDY1NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NPSEEVD756"></script>
<script src="/static/index.js"></script>
</head></html>